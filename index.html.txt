<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­”ç‹åŸå†’éšª - é€²éšç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            background-color: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        #gameContainer {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            background-color: #333;
            border: 2px solid #666;
            border-radius: 5px;
            position: relative;
        }
        #enemySection {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        #enemyHpBarContainer {
            width: 70%;
            height: 20px;
            background-color: #555;
            border: 1px solid #777;
            position: relative;
        }
        #enemyHpBar {
            height: 100%;
            background-color: #ff4500;
            width: 100%;
            transition: width 0.3s ease;
        }
        #enemyHpText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 12px;
            text-shadow: 1px 1px 2px #000;
        }
        #enemyImage {
            width: 80px;
            height: 65px;
            background-color: #444;
            margin-left: 10px;
            border: 0.5px solid #ccc;
            overflow: hidden;
            cursor: pointer;
        }
        #enemyImage img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #output {
            height: 350px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #222;
            border: 1px solid #444;
        }
        #output p {
            margin: 0;
            padding: 5px 0;
            /* ç§»é™¤åˆå§‹ opacity: 0ï¼Œæ”¹ç”± JavaScript æ§åˆ¶ */
        }
        #playerPanel {
            padding: 10px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 5px;
            margin-top: 10px;
        }
        #playerSection {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        #playerImage {
            width: 80px;
            height: 65px;
            margin-right: 10px;
            border: 0.5px solid #ccc;
            overflow: hidden;
        }
        #playerImage img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #playerHpBarContainer {
            width: 70%;
            height: 20px;
            background-color: #555;
            border: 1px solid #777;
            position: relative;
        }
        #playerHpBar {
            height: 100%;
            background-color: #ff0000;
            width: 100%;
            transition: width 0.3s ease;
        }
        #playerHpText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 12px;
            text-shadow: 1px 1px 2px #000;
        }
        #stats {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
        }
        .stat-row p {
            margin: 0;
            font-size: 14px;
        }
        #playerPanel details summary {
            color: #ffd700; /* è©³ç´°è³‡è¨Šæ–‡å­—è¨­ç‚ºé»ƒè‰² */
        }
        #playerActionsRow {
            text-align: center; /* ç½®ä¸­é¡¯ç¤º */
            margin-top: 10px;
        }
        #playerActionsLeft {
            font-weight: bold; /* æ•¸å­—åŠ ç²— */
            color: #ff7300; /* æ•¸å­—è¨­ç‚ºç¶ è‰² */
        }
        #startButton {
    padding: 8px 15px;
    font-size: 20px;
    background-color: transparent;
    color: #fff;
    border: 0.5px solid #fff;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.2s ease;
    animation: pulse 1.5s infinite ease-in-out;
    margin-top: 20px; /* æ·»åŠ ä¸Šå¤–é‚Šè· */
}

#startButton:hover {
    background-color: rgba(255, 255, 255, 0.2);
    color: #fff;
}

#startButton:active {
    animation: buttonPress 0.3s ease;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes buttonPress {
    0% { transform: scale(1); }
    50% { transform: scale(0.95); }
    100% { transform: scale(1); }
}
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes shakeRight {
            0% { transform: translate(0, 0); }
            25% { transform: translate(5px, 0); }
            50% { transform: translate(-5px, 0); }
            75% { transform: translate(2px, 0); }
            100% { transform: translate(0, 0); }
        }
        @keyframes shakeLeft {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-5px, 0); }
            50% { transform: translate(5px, 0); }
            75% { transform: translate(-2px, 0); }
            100% { transform: translate(0, 0); }
        }
        @keyframes shakeUp {
            0% { transform: translate(0, 0); }
            50% { transform: translate(0, -5px); }
            100% { transform: translate(0, 0); }
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); } /* ç¢ºä¿çµæŸæ™‚ opacity: 1 */
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .fade-out {
            animation: fadeOut 0.5s forwards;
        }
        .shake-right {
            animation: shakeRight 0.3s;
        }
        .shake-left {
            animation: shakeLeft 0.3s;
        }
        .shake-up {
            animation: shakeUp 0.5s infinite;
        }
        .bounce-in {
            animation: bounceIn 0.5s forwards;
        }
        .flash {
            animation: flash 0.5s;
        }
        button {
            padding: 10px;
            margin: 5px;
            background-color: #555;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: Arial, "Segoe UI", sans-serif; /* æ·»åŠ æ”¯æ´ Unicode çš„å­—é«” */
        }
        
        button:hover {
            background-color: #777;
        }
        
        button:active {
            animation: buttonPress 0.3s ease;
        }
        button:active {
            animation: buttonPress 0.3s ease;
        }
        /* ç‰¹æ®Šè¡Œå‹•æŒ‰éˆ•æ¨£å¼ */
.special-action-button {
    color: #ffee00; /* å°‡æ–‡å­—é¡è‰²è¨­ç‚ºç´…è‰²ï¼Œå¯è‡ªè¡Œæ›´æ”¹ */
}

/* ç‰¹æ®Šè¡Œå‹•å…§éƒ¨çš„ span æ¨£å¼ä¿æŒä¸è®Š */
.special-action-button .special-action {
    color: #ffee00; /* ç¢ºä¿å…§éƒ¨ span èˆ‡æŒ‰éˆ•ä¸€è‡´ */
}
        .enemy-name {
            color: inherit;
            user-select: none;
        }
        #infoBox {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(3, 5, 44, 0.733);
            color: #fff;
            padding: 15px; /* ç¸®æ¸›å…§è·ä»¥é©æ‡‰æ‰‹æ©Ÿ */
            border: 0.5px solid #ccc;
            border-radius: 10px;
            font-size: 14px;
            z-index: 1000;
            display: none;
            text-align: left;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
            max-width: 95vw; /* é©é…æ‰‹æ©Ÿå¯¬åº¦ */
            min-width: 320px;
            max-height: 90vh; /* é™åˆ¶é«˜åº¦ */
            overflow-y: auto;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        #infoBox.visible {
            opacity: 1;
        }
        
        #infoBox img {
            width: 300px;
            height: 240px;
            object-fit: cover;
            border: 0.5px solid #ccc;
            border-radius: 10px;
            margin-bottom: 10px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        #infoBox strong {
            font-size: 16px;
            color: #ffd700;
            display: block;
            text-align: center;
            margin-bottom: 10px;
        }
        
        /* ä¸¦æ’é¡¯ç¤ºä¸»è¦è³‡è¨Š */
        #infoBox .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* å…©æ¬„ä¸¦æ’ */
            gap: 10px;
            margin-bottom: 10px;
        }
        
        #infoBox .stats-grid span {
            font-size: 12px;
        }
        
        /* æ”¶åˆæ¨£å¼ */
        #infoBox details {
            margin-top: 10px;
        }
        
        #infoBox details summary {
            cursor: pointer;
            color: #ffd700;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        #infoBox details p {
            margin: 5px 0;
            font-size: 12px;
        }
        
        /* æ•…äº‹éƒ¨åˆ† */
#infoBox .story {
    margin-top: 15px;
    font-size: 13px;
    line-height: 1.6; /* å¢åŠ è¡Œè· */
}

/* åˆ†æ®µè½ç©ºè¡Œ */
#infoBox .story p {
    margin: 10px 0; /* æ®µè½é–“è· */
}
    </style>
</head>
<body>
    <div id="titleScreen" style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background-color: #1a1a1a;">
        <img src="https://www.independent.com.tw/wp-content/uploads/2025/02/abyssR2.png" alt="Title" style="max-width: 100%; max-height: 80%; object-fit: contain;">
        <button id="startButton">ğ•Šğ•‹ğ”¸â„ğ•‹</button>
    </div>

    <div id="gameContent" style="display: none;">
        <div id="gameContainer">
            <div id="enemySection">
                <div id="enemyHpBarContainer">
                    <div id="enemyHpBar"></div>
                    <div id="enemyHpText"></div>
                </div>
                <div id="enemyImage"></div>
            </div>
            <div id="output"></div>
            <div id="choices"></div>
            <div id="playerPanel">
                <!-- ç©å®¶é¢æ¿å…§å®¹ä¿æŒä¸è®Š -->
                <div id="playerSection">
                    <div id="playerImage">
                        <img src="https://www.independent.com.tw/wp-content/uploads/2025/02/knight1.png" alt="Player">
                    </div>
                    <div id="playerHpBarContainer">
                        <div id="playerHpBar"></div>
                        <div id="playerHpText"></div>
                    </div>
                </div>
                <div id="stats">
                    <div class="stat-row">
                        <p>æ”»æ“Š: <span id="playerAttack">${player.attack}</span></p>
                        <p>é˜²ç¦¦: <span id="playerDefense">${player.defense}</span></p>
                    </div>
                    <div class="stat-row">
                        <p>ç­‰ç´š: <span id="playerLevel">${player.level}</span> (ç¶“é©—: <span id="playerExp">${player.exp}</span>/<span id="playerExpToNext">${player.expToNextLevel}</span>)</p>
                        <p>é‡‘å¹£: <span id="playerGold">${player.gold}</span></p>
                    </div>
                </div>
                <details>
                    <summary>è©³ç´°è³‡è¨Š</summary>
                    <p>HP: <span id="playerHpDetail">${player.hp}/${player.maxHp}</span></p>
                    <p>çˆ†æ“Šç‡: <span id="playerCritChance">${(player.critChance * 100).toFixed(0)}%</span></p>
                    <p>è¿´é¿ç‡: <span id="playerDodgeChance">${(player.dodgeChance * 100).toFixed(0)}%</span></p>
                    <p>é­”æ³•: <span id="playerMagic">${player.magic.length > 0 ? player.magic.join(', ') : 'ç„¡'}</span></p>
                    <p>é“å…·: <span id="playerItems">${player.items.length > 0 ? player.items.join(', ') : 'ç„¡'}</span></p>
                    <p>å¼·åŒ–: <span id="playerEnhancements">${player.enhancements.length > 0 ? player.enhancements.join(', ') : 'ç„¡'}</span></p>
                    <p>è£å‚™: <span id="playerEquipment">${player.equipment.length > 0 ? player.equipment.join(', ') : 'ç„¡'}</span></p>
                    <p>ç‹€æ…‹: <span id="playerStatus">${player.status.length > 0 ? player.status.map(s => `<span class="${s === 'ç¥ç¦' ? 'status-positive' : 'status-negative'}">${s}</span>`).join(', ') : 'æ­£å¸¸'}</span></p>
                    <p>å…ç–«: <span id="playerImmunities">${player.immunities.length > 0 ? player.immunities.join(', ') : 'ç„¡'}</span></p>
                </details>
                <p id="playerActionsRow">å‰©é¤˜è¡Œå‹•æ¬¡æ•¸: <span id="playerActionsLeft">${actionsLeft}</span></p>
            </div>
            <div id="infoBox"></div> <!-- æ–°å¢ #infoBox -->
        </div>
    </div>
</body>

    <script>
        const titleScreen = document.getElementById('titleScreen');
        const gameContent = document.getElementById('gameContent');
        const startButton = document.getElementById('startButton');
        const output = document.getElementById('output');
        const choices = document.getElementById('choices');
        const playerHpBar = document.getElementById('playerHpBar');
        const playerHpText = document.getElementById('playerHpText');
        const enemyHpBar = document.getElementById('enemyHpBar');
        const enemyHpText = document.getElementById('enemyHpText');
        const playerPanel = document.getElementById('playerPanel');
        const gameContainer = document.getElementById('gameContainer');
        const infoBox = document.getElementById('infoBox');
        const enemyImage = document.getElementById('enemyImage');
        const playerImage = document.getElementById('playerImage');

        // å®šç¾©å…¨å±€èƒŒæ™¯éŸ³æ¨‚è®Šæ•¸
        let backgroundMusic = null;

        // ä¿®æ”¹ç©å®¶åˆå§‹è³‡æ–™ï¼Œæ–°å¢åç¨±ã€æ•…äº‹å’Œåœ–ç‰‡
        let player = {
            name: 'ç„¡åé¨å£«',
            hp: 50,
            maxHp: 50,
            attack: 10,
            defense: 5,
            level: 1,
            exp: 0,
            expToNextLevel: 50,
            gold: 0,
            critChance: 0.2,
            dodgeChance: 0,
            magic: [],
            items: [],
            enhancements: [],
            equipment: [],
            inventory: [],
            status: [],
            immunities: [],
            sealedAction: null,
            iceMagicUses: 0,
            iceMagicCooldown: 0,
            tempStats: { attack: 0, defense: 0, hp: 0 },
            eventDesc: 'ä½ æ˜¯ä¸€åæ‹‹æ£„è‡ªå·±åå­—çš„é¨å£«ï¼Œæ›¾ç¶“å®ˆè­·ç‹åœ‹é‚Šå¢ƒï¼Œç„¡æ•¸æˆ°å½¹ä¸­ç£¨ç¤ªå‡ºçš„æ„å¿—å¦‚é‹¼éµèˆ¬å …éŸŒã€‚ç„¶è€Œï¼Œé­”ç‹çš„å´›èµ·æ‘§æ¯€äº†ä½ çš„å®¶åœ’ï¼Œè¦ªå‹çš„é®®è¡€æŸ“ç´…äº†ä½ çš„ç›”ç”²ã€‚å¦‚ä»Šï¼Œä½ å¸¶è‘—å¾©ä»‡çš„ç«ç„°ï¼Œå­¤èº«è¸å…¥é­”ç‹åŸï¼Œèª“è¦å°‡é»‘æš—é€£æ ¹æ‹”èµ·ï¼Œå°‹æ‰¾æ•‘è´–èˆ‡æ¦®è€€ã€‚', // åŸå§‹æè¿°
            story: 'åœ¨ç‹åœ‹é‚Šå¢ƒçš„é¢¨éœœä¸­ï¼Œä½ æ›¾æ˜¯ç„¡äººä¸çŸ¥çš„å®ˆè­·è€…ï¼Œæ‰‹æŒé•·åŠå®ˆæœ›è‘—å’Œå¹³çš„æ­²æœˆã€‚æ¯ç•¶å¤œå¹•é™è‡¨ï¼Œæ‘è½çš„ç‡ˆç«æ˜¯ä½ å¿ƒä¸­çš„æ…°è—‰ã€‚ç„¶è€Œï¼Œé‚£å€‹è¡€è…¥çš„å¤œæ™šï¼Œé­”ç‹çš„è»åœ˜å¦‚æ½®æ°´èˆ¬æ¹§ä¾†ï¼Œç«ç„°åå™¬äº†ä½ çš„æ•…é„‰ï¼Œè¦ªäººçš„å“­å–Šåœ¨è€³é‚Šå›éŸ¿ã€‚ä½ è·ªåœ¨å»¢å¢Ÿä¸­ï¼Œæ¡ç·Šæ–·è£‚çš„åŠåˆƒï¼Œç«‹ä¸‹èª“è¨€ï¼šä¸æƒœä¸€åˆ‡ä»£åƒ¹ï¼Œä¹Ÿè¦è®“é­”ç‹ä»˜å‡ºè¡€å‚µã€‚å¦‚ä»Šï¼Œå­¤èº«ä¸€äººçš„ä½ è¸å…¥é€™ç‰‡è©›å’’ä¹‹åœ°ï¼Œç›”ç”²ä¸Šçš„æ¯ä¸€é“å‚·ç—•ï¼Œéƒ½æ˜¯ä½ ä¸å±ˆçš„è­‰æ˜ã€‚', // æ›´æ·±å…¥çš„èƒŒæ™¯æ•…äº‹
            image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/knight1.png'
        };

        let currentFloor = 1;
        let enemy = null;
        let gameState = 'start';
        let defending = false;
        let statusTurns = {};
        let actionsLeft = 3;
        let exploreCount = 0;
        let bossDefeatedCount = 0;
        let baseStats = { attack: player.attack, defense: player.defense, hp: player.hp };

        const enemyColors = {
            'éª·é«å…µ': '#00ffff',
            'å“¥å¸ƒæ—': '#00ff00',
            'é»‘æš—ç‹¼': '#ff00ff',
            'é­”åƒ': '#ffa500',
            'å¸è¡€è™è ': '#ff0000',
            'é­”ç‹': '#ff69b4',
            'å¹½éˆ': '#a9a9a9',
            'ç«ç„°å…ƒç´ ': '#ff4500',
            'å†°éœœå·¨äºº': '#00b7eb',
            'æ¯’è›‡': '#9acd32'
        };

        const enemies = [
    { 
        name: 'éª·é«å…µ', 
        hp: 20, 
        attack: 8, 
        defense: 3, 
        special: 'bleed', 
        specialDesc: 'æµè¡€', // ä¸­æ–‡ç¿»è­¯
        eventDesc: 'ä¸€å…·æŠ«è‘—ç ´çˆ›ç›”ç”²çš„éª·é«ï¼Œç©ºæ´çš„çœ¼çœ¶é–ƒè‘—å¹½ç¶ å…‰èŠ’ï¼Œæ‰‹ä¸­çš„ç”Ÿé½é•·åŠæ•£ç™¼è‘—æ­»äº¡æ°£æ¯ã€‚', // åŸå§‹æè¿°
        story: 'é€™äº›éª·é«å…µæ›¾æ˜¯ç‹åœ‹çš„å¿ èª è¡›å£«ï¼Œåœ¨é­”ç‹å…¥ä¾µæ™‚èª“æ­»å®ˆè­·åŸç‰†ã€‚ç„¶è€Œï¼Œæˆ°æ•—å¾Œå®ƒå€‘è¢«é‚ªæƒ¡çš„é­”æ³•å¾©æ´»ï¼Œéˆé­‚è¢«ç¦éŒ®åœ¨è…æœ½çš„éª¨éª¸ä¸­ã€‚å¦‚ä»Šï¼Œå®ƒå€‘æ¼«ç„¡ç›®çš„æ¸¸è•©åœ¨é­”ç‹åŸå…§ï¼Œçœ¼ä¸­å¹½ç¶ çš„ç«ç„°æ˜¯å°æ˜”æ—¥æ¦®è€€çš„æ‰­æ›²å›æ†¶ï¼Œæ‰‹ä¸­çš„é•·åŠé›–å·²ç”Ÿé½ï¼Œå»ä»å¸¶è‘—ç„¡ç›¡çš„æ€¨å¿µã€‚', // æ›´æ·±å…¥çš„æ•…äº‹
        exp: 10, 
        gold: 5, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/skeleton.png' 
    },
    { 
        name: 'å“¥å¸ƒæ—', 
        hp: 25, 
        attack: 10, 
        defense: 2, 
        special: null, 
        specialDesc: 'ç„¡', 
        eventDesc: 'ä¸€éš»çŸ®å°é†œé™‹çš„å“¥å¸ƒæ—ï¼Œç¶ è‰²çš„çš®è†šæ»¿æ˜¯ç–£ç‹€çªèµ·ï¼Œæ‰‹ä¸­æ¡è‘—å½æ›²çš„åŒ•é¦–ï¼Œç™¼å‡ºåˆºè€³çš„ç¬‘è²ã€‚', 
        story: 'å“¥å¸ƒæ—æ—ç¾¤ä¸–ä»£å±…ä½åœ¨é­”ç‹åŸå‘¨åœçš„é™°æš—æ´ç©´ä¸­ï¼Œé æ å¥ªèˆ‡å·ç«Šç‚ºç”Ÿã€‚å®ƒå€‘çš„ç¥–å…ˆæ›¾æ˜¯æ£®æ—ä¸­çš„ç²¾éˆï¼Œå› è§¸æ€’å¤ä»£é­”ç¥è€Œè¢«è©›å’’ï¼Œè®Šæˆé€™å‰¯é†œé™‹æ¨¡æ¨£ã€‚å¦‚ä»Šï¼Œå®ƒå€‘æˆç‚ºé­”ç‹çš„çˆªç‰™ï¼Œç”¨å°–éŠ³çš„åŒ•é¦–å’Œç‹¡è©çš„ç¬‘è²ï¼Œç‚ºè‡ªå·±çš„ç”Ÿå­˜æ™æ‰ã€‚', 
        exp: 15, 
        gold: 8, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/goblin.png' 
    },
    { 
        name: 'é»‘æš—ç‹¼', 
        hp: 30, 
        attack: 12, 
        defense: 4, 
        special: 'poison', 
        specialDesc: 'ä¸­æ¯’', 
        eventDesc: 'ä¸€é ­æ¯›è‰²å¦‚å¢¨çš„é»‘ç‹¼ï¼Œå°–ç‰™æ»´è‘—æ¯’æ¶²ï¼Œè¡€ç´…çš„é›™çœ¼åœ¨é»‘æš—ä¸­é–ƒçˆï¼Œç™¼å‡ºä½æ²‰çš„å’†å“®ã€‚', 
        story: 'é»‘æš—ç‹¼æ›¾æ˜¯æ£®æ—æ·±è™•çš„è–ç¸ï¼Œå®ˆè­·è‘—è‡ªç„¶çš„å¹³è¡¡ã€‚ç„¶è€Œï¼Œé­”ç‹çš„é»‘æš—åŠ›é‡æ»²é€å¤§åœ°ï¼Œå°‡å®ƒå€‘æ‰­æ›²æˆå…‡æ®˜çš„æ€ªç‰©ã€‚å®ƒå€‘çš„æ¯’æ¶²ä¾†è‡ªè¢«æ±¡æŸ“çš„è¡€æ¶²ï¼Œç´…çœ¼ä¸­çš„æ€’ç«æ˜¯å°å¤±å»å®¶åœ’çš„ç„¡è²æ§è¨´ã€‚å¦‚ä»Šï¼Œå®ƒå€‘åœ¨é­”ç‹åŸä¸­çµæ®ºä¸€åˆ‡æ´»ç‰©ï¼Œæˆç‚ºé»‘æš—çš„å¿ å¯¦åƒ•äººã€‚', 
        exp: 20, 
        gold: 10, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/darkwolf.png' 
    },
    { 
        name: 'é­”åƒ', 
        hp: 40, 
        attack: 15, 
        defense: 8, 
        special: 'stun', 
        specialDesc: 'æšˆçœ©', 
        eventDesc: 'ä¸€åº§ç”±å‰›ç¡¬çš„è¼çŸ³é›•æˆçš„å·¨å‹é­”åƒï¼Œé—œç¯€é–“å†’è‘—é­”æ€§çš„å…‰èŠ’ï¼Œæ¯ä¸€æ­¥éƒ½éœ‡å¾—åœ°é¢é¡«æŠ–ã€‚', 
        story: 'é­”åƒæ˜¯å¤ä»£é­”æ³•å¸«çš„å‚‘ä½œï¼Œç”¨è¼çŸ³èˆ‡é­”åŠ›æ‰“é€ ï¼Œæ—¨åœ¨å®ˆè­·è–æ®¿å…å—å…¥ä¾µã€‚ç„¶è€Œï¼Œé­”ç‹å¥ªå–äº†é€™äº›å‚‘ä½œçš„æ§åˆ¶æ¬Šï¼Œå°‡å®ƒå€‘è®Šæˆç„¡æƒ…çš„æˆ°çˆ­æ©Ÿå™¨ã€‚å®ƒå€‘çš„æ¯ä¸€æ¬¡æ­¥ä¼éƒ½å¸¶è‘—æ˜”æ—¥å‰µé€ è€…çš„éºæ†¾ï¼Œå¦‚ä»Šåªç‚ºæ¯€æ»…è€Œå­˜åœ¨ï¼Œæ²‰é»˜å»è‡´å‘½ã€‚', 
        exp: 25, 
        gold: 15, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/golem.png' 
    },
    { 
        name: 'å¸è¡€è™è ', 
        hp: 25, 
        attack: 10, 
        defense: 3, 
        special: 'leech', 
        specialDesc: 'å¸è¡€', 
        eventDesc: 'ä¸€éš»å·¨å¤§çš„è™è ï¼Œç¿…è†€å¦‚ç ´èˆŠæ–—ç¯·ï¼ŒçŒ©ç´…çš„é›™çœ¼é€è‘—è²ªå©ªï¼Œå°–éŠ³çš„ç ç‰™æ¸´æ±‚è‘—é®®è¡€ã€‚', 
        story: 'é€™äº›å¸è¡€è™è èª•ç”Ÿæ–¼é­”ç‹åŸåœ°ä¸‹çš„è¡€æ± ï¼Œç‰ å€‘çš„ç¥–å…ˆæ›¾æ˜¯æ™®é€šçš„å¤œè¡Œç”Ÿç‰©ï¼Œå› é•·æœŸå¸é£Ÿè¢«è©›å’’çš„è¡€æ¶²è€Œè®Šç•°ã€‚å®ƒå€‘çš„çŒ©ç´…é›™çœ¼èƒ½æ„ŸçŸ¥ç”Ÿå‘½æ°£æ¯ï¼Œå·¨å¤§çš„ç¿…è†€åœ¨é»‘æš—ä¸­ç„¡è²æ»‘ç¿”ï¼Œæ¯ä¸€æ¬¡çµé£Ÿéƒ½æ˜¯å°é®®è¡€çš„ç„¡ç›¡æ¸´æœ›ã€‚', 
        exp: 18, 
        gold: 12, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/vampirebat.png' 
    },
    { 
        name: 'å¹½éˆ', 
        hp: 20, 
        attack: 9, 
        defense: 2, 
        special: 'curse', 
        specialDesc: 'è©›å’’', 
        eventDesc: 'ä¸€å€‹åŠé€æ˜çš„éˆé«”ï¼Œç™¼å‡ºæ·’å²çš„ä½èªï¼Œèº«é‚Šç’°ç¹è‘—è©­ç•°çš„å¯’æ°£ã€‚', 
        story: 'å¹½éˆæ˜¯é‚£äº›åœ¨é­”ç‹åŸæˆ°æ­»è€…çš„æ®˜é­‚ï¼Œè¢«é‚ªæƒ¡é­”æ³•æŸç¸›ï¼Œç„¡æ³•å®‰æ¯ã€‚å®ƒå€‘æ›¾æ˜¯å‹‡æ•¢çš„æˆ°å£«æˆ–ç„¡è¾œçš„æ‘æ°‘ï¼Œå¦‚ä»Šåªå‰©æ€¨æ¨èˆ‡ç—›è‹¦ï¼Œä½èªä¸­è¨´èªªè‘—æœªç«Ÿçš„éºé¡˜ã€‚å¯’æ°£æ˜¯å®ƒå€‘éˆé­‚çš„ç¢ç‰‡ï¼Œè©¦åœ–å°‡æ´»äººæ‹–å…¥æ°¸æ†çš„é»‘æš—ã€‚', 
        exp: 15, 
        gold: 10, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/ghost.png.png' 
    },
    { 
        name: 'ç«ç„°å…ƒç´ ', 
        hp: 35, 
        attack: 14, 
        defense: 5, 
        special: 'burn', 
        specialDesc: 'ç‡ƒç‡’', 
        eventDesc: 'ä¸€åœ˜ç†Šç†Šç‡ƒç‡’çš„ç«ç„°ï¼Œæ•£ç™¼è‘—ç‚™ç†±çš„é«˜æº«ï¼Œç«ç„°ä¸­éš±ç´„å¯è¦‹äººå½¢ã€‚', 
        story: 'ç«ç„°å…ƒç´ æ˜¯é­”ç‹å¬å–šçš„ç´”ç²¹å…ƒç´ ä¹‹åŠ›ï¼Œå¾åœ°ç„æ·±è™•çš„ç†”å²©ä¸­èª•ç”Ÿã€‚å®ƒå€‘æ²’æœ‰æ€æƒ³ï¼Œåªæœ‰æ¯€æ»…çš„æœ¬èƒ½ï¼Œç«ç„°ä¸­éš±ç´„çš„äººå½¢æ˜¯æ›¾è¢«ç»ç¥­çš„éˆé­‚æ®˜å½±ã€‚å®ƒå€‘çš„å­˜åœ¨æ˜¯å°ç”Ÿå‘½çš„å˜²å¼„ï¼Œå°‡ä¸€åˆ‡åŒ–ç‚ºç°ç‡¼ã€‚', 
        exp: 22, 
        gold: 13, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/fireelemental.png.png' 
    },
    { 
        name: 'å†°éœœå·¨äºº', 
        hp: 45, 
        attack: 13, 
        defense: 10, 
        special: 'freeze', 
        specialDesc: 'å‡çµ', 
        eventDesc: 'ä¸€åº§è¦†è“‹å†°éœœçš„å·¨äººï¼Œæ‰‹ä¸­å·¨éŒ˜æ•£ç™¼è‘—å¯’æ°£ï¼Œæ¯ä¸€æ­¥éƒ½å‡çµåœ°é¢ã€‚', 
        story: 'å†°éœœå·¨äººä¾†è‡ªåŒ—æ–¹å†°åŸçš„å¤è€ç¨®æ—ï¼Œæ›¾èˆ‡äººé¡ç°½è¨‚å’Œå¹³å¥‘ç´„ã€‚ç„¶è€Œï¼Œé­”ç‹çš„é»‘æš—é­”æ³•å¥´å½¹äº†å®ƒå€‘ï¼Œå°‡å®ƒå€‘è®Šæˆå†·é…·çš„å®ˆè¡›ã€‚å·¨éŒ˜ä¸­çš„å¯’æ°£æ˜¯å®ƒå€‘å¤±å»è‡ªç”±çš„è±¡å¾µï¼Œæ¯ä¸€æ“Šéƒ½å¸¶è‘—å°å‘½é‹çš„ç„¡è²æ€’å¼ã€‚', 
        exp: 28, 
        gold: 18, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/frostgiant.png' 
    },
    { 
        name: 'æ¯’è›‡', 
        hp: 25, 
        attack: 11, 
        defense: 4, 
        special: 'poison', 
        specialDesc: 'ä¸­æ¯’', 
        eventDesc: 'ä¸€æ¢è‰²å½©æ–‘æ–•çš„æ¯’è›‡ï¼Œåè‘—ä¿¡å­ï¼Œçœ¼ä¸­é–ƒè‘—é™°å†·çš„å…‰èŠ’ã€‚', 
        story: 'æ¯’è›‡æ˜¯é­”ç‹åŸåœ°ä¸‹æ·±è™•çš„ç”¢ç‰©ï¼Œç‰ å€‘å¾è¢«è©›å’’çš„æ²¼æ¾¤ä¸­å­µåŒ–ï¼Œè‰²å½©æ–‘æ–•çš„é±—ç‰‡éš±è—è‘—è‡´å‘½åŠ‡æ¯’ã€‚å‚³èªªé€™äº›è›‡æ›¾æ˜¯æŸå€‹å¤±è½ç‹åœ‹çš„å®ˆè­·éˆï¼Œè¢«é­”ç‹çš„åŠ›é‡è…åŒ–ï¼Œæˆç‚ºæ½›ä¼åœ¨é™°å½±ä¸­çš„æš—æ®ºè€…ã€‚', 
        exp: 20, 
        gold: 12, 
        image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/venomsnake.png' 
    }
];

        const rewards = [
    { name: 'åŠ›é‡æå‡', desc: 'æ°¸ä¹…æå‡5é»æ”»æ“ŠåŠ›ï¼Œå¢å¼·ä½ çš„æˆ°é¬¥èƒ½åŠ›ã€‚', effect: () => { player.attack += 5; player.enhancements.push('åŠ›é‡æå‡ (æ”»æ“Š +5)'); updatePlayerPanel(); } },
    { name: 'ç”Ÿå‘½æå‡', desc: 'æ°¸ä¹…æå‡20é»ç”Ÿå‘½ä¸Šé™ï¼Œä¸¦æ¢å¾©ç­‰é‡HPï¼ˆä¸è¶…éä¸Šé™ï¼‰ã€‚', effect: () => { player.maxHp += 20; player.hp = Math.min(player.maxHp, player.hp + 20); player.enhancements.push('ç”Ÿå‘½æå‡ (ç”Ÿå‘½ +20)'); updatePlayerHpBar(); updatePlayerPanel(); } },
    { name: 'é˜²ç¦¦æå‡', desc: 'æ°¸ä¹…æå‡3é»é˜²ç¦¦åŠ›ï¼Œæ¸›å°‘å—åˆ°çš„å‚·å®³ã€‚', effect: () => { player.defense += 3; player.enhancements.push('é˜²ç¦¦æå‡ (é˜²ç¦¦ +3)'); updatePlayerPanel(); } },
    { name: 'ç«ç„°é­”æ³•', desc: 'ç²å¾—æˆ–å‡ç´šç«ç„°é­”æ³•ï¼Œæ”»æ“Š+10ä¸¦é™„åŠ ç¼ç‡’æ•ˆæœï¼ˆé™ä½æ•µäººé˜²ç¦¦ï¼‰ï¼Œç­‰ç´šè¶Šé«˜å‚·å®³è¶Šé«˜ã€‚', level: 1, effect: () => upgradeMagic('ç«ç„°é­”æ³•', 'æ”»æ“Š +10 & ç¼ç‡’', 10) },
    { name: 'å†°å‡é­”æ³•', desc: 'ç²å¾—æˆ–å‡ç´šå†°å‡é­”æ³•ï¼Œé™ä½æ•µäººæ”»æ“ŠåŠ›ï¼ˆåˆå§‹70%æ•ˆæœï¼‰ï¼Œç­‰ç´šè¶Šé«˜æ¸›ç›Šè¶Šå¼·ã€‚', level: 1, effect: () => upgradeMagic('å†°å‡é­”æ³•', 'é™ä½æ•µäººæ”»æ“Š', 0.7) },
    { name: 'é›·é›»é­”æ³•', desc: 'ç²å¾—æˆ–å‡ç´šé›·é›»é­”æ³•ï¼Œæ”»æ“Š+15ï¼ˆ50%å‘½ä¸­ç‡ï¼‰ï¼Œç­‰ç´šè¶Šé«˜å‚·å®³è¶Šé«˜ã€‚', level: 1, effect: () => upgradeMagic('é›·é›»é­”æ³•', 'æ”»æ“Š +15 (50%å‘½ä¸­)', 15) },
    { name: 'æ²»ç™‚è—¥æ°´', desc: 'ç²å¾—ä¸€ç“¶æ²»ç™‚è—¥æ°´ï¼Œä½¿ç”¨å¾Œæ¢å¾©20 HPä¸¦æ¸…é™¤ä¸­æ¯’ç‹€æ…‹ï¼ˆæœ€å¤šæŒæœ‰1ç“¶ï¼‰ã€‚', effect: () => { if (player.items.filter(item => item === 'æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)').length < 1) { player.items.push('æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)'); player.inventory.push('æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)'); updatePlayerPanel(); } } },
    { name: 'ç‚¸å½ˆ', desc: 'ç²å¾—ä¸€æšç‚¸å½ˆï¼Œä½¿ç”¨å¾Œå°æ•µäººé€ æˆ50é»å›ºå®šå‚·å®³ï¼ˆæœ€å¤šæŒæœ‰1å€‹ï¼‰ã€‚', effect: () => { if (player.items.filter(item => item === 'ç‚¸å½ˆ (50 å‚·å®³)').length < 1) { player.items.push('ç‚¸å½ˆ (50 å‚·å®³)'); player.inventory.push('ç‚¸å½ˆ (50 å‚·å®³)'); updatePlayerPanel(); } } },
    { name: 'é­”åŠ', desc: 'ç²å¾—æˆ–å‡ç´šé­”åŠï¼Œæ°¸ä¹…æå‡5é»æ”»æ“ŠåŠ›ï¼Œç­‰ç´šè¶Šé«˜åŠ æˆè¶Šå¤šã€‚', level: 1, effect: () => upgradeEquipment('é­”åŠ', 'æ”»æ“Š +5', 5) },
    { name: 'è–ç›¾', desc: 'ç²å¾—æˆ–å‡ç´šè–ç›¾ï¼Œæ°¸ä¹…æå‡5é»é˜²ç¦¦åŠ›ï¼Œç­‰ç´šè¶Šé«˜åŠ æˆè¶Šå¤šã€‚', level: 1, effect: () => upgradeEquipment('è–ç›¾', 'é˜²ç¦¦ +5', 5) },
    { name: 'å¹¸é‹æˆ’æŒ‡', desc: 'ç²å¾—æˆ–å‡ç´šå¹¸é‹æˆ’æŒ‡ï¼Œæå‡10%çˆ†æ“Šç‡ï¼Œç­‰ç´šè¶Šé«˜çˆ†æ“Šç‡è¶Šé«˜ã€‚', level: 1, effect: () => upgradeAccessory('å¹¸é‹æˆ’æŒ‡', 'çˆ†æ“Šç‡ +10%', 0.1, 'critChance') },
    { name: 'é¢¨ä¹‹è­·ç¬¦', desc: 'ç²å¾—æˆ–å‡ç´šé¢¨ä¹‹è­·ç¬¦ï¼Œæå‡10%è¿´é¿ç‡ï¼Œç­‰ç´šè¶Šé«˜è¿´é¿ç‡è¶Šé«˜ã€‚', level: 1, effect: () => upgradeAccessory('é¢¨ä¹‹è­·ç¬¦', 'è¿´é¿ç‡ +10%', 0.1, 'dodgeChance') },
    { name: 'æ·¨åŒ–é …éŠ', desc: 'ç²å¾—æˆ–å‡ç´šæ·¨åŒ–é …éŠï¼Œå…ç–«ä¸­æ¯’ç‹€æ…‹ï¼Œæ•ˆæœä¸éš¨ç­‰ç´šè®ŠåŒ–ã€‚', level: 1, effect: () => upgradeAccessory('æ·¨åŒ–é …éŠ', 'å…ç–«ä¸­æ¯’', 'poison', 'immunities') },
    { name: 'ç«ç„°æŒ‡ç’°', desc: 'ç²å¾—æˆ–å‡ç´šç«ç„°æŒ‡ç’°ï¼Œå…ç–«ç‡ƒç‡’ç‹€æ…‹ï¼Œæ•ˆæœä¸éš¨ç­‰ç´šè®ŠåŒ–ã€‚', level: 1, effect: () => upgradeAccessory('ç«ç„°æŒ‡ç’°', 'å…ç–«ç‡ƒç‡’', 'burn', 'immunities') }
        ];
        const merchantOptions = {
            'è³¼è²·æ²»ç™‚è—¥æ°´ (20 é‡‘å¹£)': 'èŠ±è²»20é‡‘å¹£è³¼è²·ä¸€ç“¶æ²»ç™‚è—¥æ°´ï¼Œä½¿ç”¨å¾Œæ¢å¾©20 HPä¸¦æ¸…é™¤ä¸­æ¯’ç‹€æ…‹ï¼ˆæœ€å¤šæŒæœ‰1ç“¶ï¼‰ã€‚',
            'è³¼è²·ç‚¸å½ˆ (30 é‡‘å¹£)': 'èŠ±è²»30é‡‘å¹£è³¼è²·ä¸€æšç‚¸å½ˆï¼Œä½¿ç”¨å¾Œå°æ•µäººé€ æˆ50é»å›ºå®šå‚·å®³ï¼ˆæœ€å¤šæŒæœ‰1å€‹ï¼‰ã€‚',
            'æ²»ç™’ç‹€æ…‹ (50 é‡‘å¹£)': 'èŠ±è²»50é‡‘å¹£æ¸…é™¤æ‰€æœ‰ç•°å¸¸ç‹€æ…‹ï¼ˆä¸­æ¯’ã€æµè¡€ã€è©›å’’ã€ç‡ƒç‡’ã€å‡çµï¼‰ã€‚',
            'é›¢é–‹': 'çµæŸèˆ‡ç¥ç§˜å•†äººçš„äº¤æ˜“ï¼Œè¿”å›è¡Œå‹•é¸æ“‡ç•«é¢ã€‚'
        };
        const exploreEvents = [
            { name: 'æ€ªç‰©', weight: 0.75, action: encounterMonster },
            { name: 'å¯¶ç®±', weight: 0.05, action: offerReward },
            { name: 'é™·é˜±', weight: 0.05, action: () => { player.hp = Math.max(0, player.hp - 15); display('è…³ä¸‹çš„çŸ³æ¿çªç„¶ä¸‹é™·ï¼Œ<span class="action">æ¯’åˆº</span>å¾å››é¢åˆºå‡ºï¼Œä½ ç—›å‘¼ä¸€è²ï¼Œé®®è¡€æŸ“ç´…åœ°é¢ï¼Œæå¤± <span class="status-negative">15 HP</span>ï¼'); checkGameOver(); updatePlayerHpBar(); afterAction(); } },
            { name: 'äº‹ä»¶', weight: 0.15, action: () => { const event = events[Math.floor(Math.random() * events.length)]; display(`ä½ é‡åˆ°äº†ä¸€å€‹<span class="highlight">${event.name}</span>ï¼`); event.action(); } }
        ];
        const floorActions = {
    'æ¢ç´¢': 'æ·±å…¥é­”ç‹åŸæ¢ç´¢ï¼Œå¯èƒ½é­é‡æ€ªç‰©ã€ç™¼ç¾å¯¶ç®±ã€è§¸ç™¼é™·é˜±æˆ–é‡åˆ°ç‰¹æ®Šäº‹ä»¶ï¼ˆæ€ªç‰©æ©Ÿç‡75%ï¼Œå¯¶ç®±5%ï¼Œé™·é˜±5%ï¼Œäº‹ä»¶15%ï¼‰ã€‚æ¯æ¬¡æ¢ç´¢æ¶ˆè€—1æ¬¡è¡Œå‹•ï¼Œå–®å±¤æœ€å¤šæ¢ç´¢2æ¬¡ã€‚',
    'æ•´å‚™': 'åœ¨å®‰å…¨è§’è½ä¼‘æ¯ï¼Œæ¢å¾©15 HPä¸¦æ¸…é™¤æ‰€æœ‰ç•°å¸¸ç‹€æ…‹ï¼ˆä¸­æ¯’ã€æµè¡€ç­‰ï¼‰ï¼Œæ¶ˆè€—1æ¬¡è¡Œå‹•ã€‚',
    'è¨“ç·´': 'é€²è¡Œåˆ»è‹¦è¨“ç·´ï¼Œæå‡èƒ½åŠ›ã€‚25%æ©Ÿç‡å¤§æˆåŠŸï¼ˆæ”»æ“Š+2æˆ–ç„¡æå‡ï¼Œé˜²ç¦¦+2ï¼‰ï¼Œå¦å‰‡æ™®é€šæˆåŠŸï¼ˆæ”»æ“Š+1æˆ–ç„¡æå‡ï¼Œé˜²ç¦¦+1ï¼‰ï¼Œç”Ÿå‘½ä¸Šé™å§‹çµ‚+5ï¼Œæ¶ˆè€—1æ¬¡è¡Œå‹•ã€‚'
        };

        const events = [
            { name: 'ç¥ç§˜å•†äºº', action: tradeWithMerchant },
            { name: 'è€å·«å¸«', action: () => {
                display('ä¸€ä½ä½åƒ‚çš„<span class="highlight">è€å·«å¸«</span>æ””ä½ä½ ï¼Œä»–ä½èªï¼šâ€œæˆ‘èƒ½æ²»ç™’ä½ çš„ç—›è‹¦ã€‚â€');
                clearChoices();
                addChoice('æ¥å—æ²»ç™‚ (æ¢å¾© 30 HP)', () => {
                    const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/beast-on-2.mp3'; // é ç•™éŸ³æ•ˆ URL
                    playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
                    player.hp = Math.min(player.maxHp, player.hp + 30);
                    display('è€å·«å¸«æ®å‹•æ³•æ–ï¼Œä¸€é™£æš–å…‰ç± ç½©ä½ ï¼Œæ¢å¾© <span class="status-positive">30 HP</span>ï¼');
                    updatePlayerHpBar();
                    afterAction();
                });
                addChoice('æ‹’çµ•', () => {
                    const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/12/guide-open.mp3'; // é ç•™éŸ³æ•ˆ URL
                    playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
                    player.defense += 1;
                    display('ä½ ç¡¬æ´¾åœ°æ‹’çµ•äº†è€å·«å¸«çš„æ²»ç™‚ï¼Œå±•ç¾å …éŸŒæ„å¿—ï¼Œé˜²ç¦¦æå‡ <span class="status-positive">1 é»</span>ï¼');
                    updatePlayerPanel();
                    afterAction();
                });
            } },
            { name: 'è©›å’’é›•åƒ', action: () => { applyStatus('è©›å’’', 2); display('ä½ è§¸ç¢°äº†ä¸€åº§è©­ç•°çš„<span class="highlight">é›•åƒ</span>ï¼Œä¸€é™£é»‘éœ§çºç¹ä½ ï¼Œä½ æ„Ÿåˆ°åŠ›é‡è¢«å‰Šå¼±ï¼Œé€²å…¥<span class="status-negative">è©›å’’</span>ç‹€æ…‹ï¼'); updatePlayerPanel(); afterAction(); } }
        ];

        const specialActions = [
    {
        name: 'æˆ°å¼',
        desc: 'ç™¼å‡ºéœ‡æ‡¾å¼è²ï¼Œæš«æ™‚æå‡5é»æ”»æ“ŠåŠ›ï¼Œæ•µäººéš¨å³è¡Œå‹•ã€‚',
        action: () => {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/12/bear-sounds.mp3';
            playSoundWithVolume(soundUrl);
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                display('ä½ ç™¼å‡ºä¸€è²é©šå¤©å‹•åœ°çš„<span class="action">æˆ°å¼</span>ï¼Œè‚Œè‚‰é¼“è„¹ï¼ŒåŠ›é‡æ¿€å¢ï¼Œæ”»æ“ŠåŠ›æš«æ™‚æå‡ <span class="status-positive">5 é»</span>ï¼', true);
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        player.tempStats.attack += 5;
                        updatePlayerPanel();
                        enemyTurn();
                    }, 1000);
                }, 1000);
            }, 300);
        }
    },
    {
        name: 'éˆå·§ç¿»æ»¾',
        desc: 'æ•æ·ç¿»æ»¾ï¼Œæš«æ™‚æå‡3é»é˜²ç¦¦åŠ›ï¼Œæ•µäººéš¨å³è¡Œå‹•ã€‚',
        action: () => {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/05/é–ƒèº².mp3';
            playSoundWithVolume(soundUrl);
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                display('ä½ éˆæ•åœ°<span class="action">ç¿»æ»¾</span>ä¸€åœˆï¼Œæ‰¾åˆ°æœ€ä½³é˜²å®ˆä½ç½®ï¼Œé˜²ç¦¦åŠ›æš«æ™‚æå‡ <span class="status-positive">3 é»</span>ï¼', true);
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        player.tempStats.defense += 3;
                        updatePlayerPanel();
                        enemyTurn();
                    }, 1000);
                }, 1000);
            }, 300);
        }
    },
    {
        name: 'å†¥æƒ³',
        desc: 'éœå¿ƒå†¥æƒ³ï¼Œæ¢å¾©15 HPï¼Œæ•µäººéš¨å³è¡Œå‹•ã€‚',
        action: () => {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/10/è–é­”æ³•.mp3';
            playSoundWithVolume(soundUrl);
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                display('ä½ é–‰ç›®<span class="action">å†¥æƒ³</span>ï¼Œèª¿æ¯ä¹‹é–“ï¼Œèº«é«”çš„å‚·ç—›ç·©ç·©æ¶ˆé€€ï¼Œæ¢å¾© <span class="status-positive">15 HP</span>ï¼', true);
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        player.hp = Math.min(player.maxHp, player.hp + 15);
                        player.tempStats.hp += 15;
                        updatePlayerHpBar();
                        updatePlayerPanel();
                        enemyTurn();
                    }, 1000);
                }, 1000);
            }, 300);
        }
    },
    {
        name: 'æŒ‘é‡',
        desc: 'æŒ‘é‡æ•µäººï¼Œé™ä½å…¶5é»æ”»æ“ŠåŠ›ï¼Œæ•µäººéš¨å³è¡Œå‹•ã€‚',
        action: () => {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/03/skill-change.mp3';
            playSoundWithVolume(soundUrl);
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                display('ä½ å°æ•µäºº<span class="action">æŒ‘é‡</span>ï¼Œæ¿€æ€’äº†å®ƒï¼Œå®ƒæ°£å¾—å¤±å»ç†æ™ºï¼Œæ”»æ“ŠåŠ›é™ä½ <span class="status-negative">5 é»</span>ï¼', true);
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        enemy.attack = Math.max(0, enemy.attack - 5);
                        enemyTurn();
                    }, 1000);
                }, 1000);
            }, 300);
        }
    },
    {
        name: 'è¿…æ·ä¸€æ“Š',
        desc: 'å¿«é€Ÿæ”»æ“Šï¼Œé€ æˆåŸºç¤å‚·å®³ï¼Œç„¡è¦–æ•µäººé˜²ç¦¦ï¼Œæ•µäººéš¨å³è¡Œå‹•ã€‚',
        action: () => {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/02/Start-phy.mp3';
            playSoundWithVolume(soundUrl);
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                let damage = player.attack + player.tempStats.attack;
                display(`ä½ èº«å½¢å¦‚é¢¨ï¼Œ<span class="action">è¿…æ·ä¸€æ“Š</span>åŠƒå‡ºä¸€é“æ®˜å½±ï¼Œå°<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>é€ æˆ ${damage} é»å‚·å®³ï¼`, true);
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        enemy.hp -= damage;
                        updateEnemyHpBar();
                        enemy.hp <= 0 ? winCombat() : enemyTurn();
                    }, 1000);
                }, 1000);
            }, 300);
        }
    },
    {
        name: 'ç¥ˆç¦±',
        desc: 'ç¥ˆæ±‚ç¥åŠ©ï¼Œ50%æ©Ÿç‡æ¢å¾©10 HPï¼Œæ•µäººéš¨å³è¡Œå‹•ã€‚',
        action: () => {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/04/dice.mp3';
            playSoundWithVolume(soundUrl);
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                if (Math.random() < 0.5) {
                    player.hp = Math.min(player.maxHp, player.hp + 10);
                    player.tempStats.hp += 10;
                    display('ä½ ä½è²<span class="action">ç¥ˆç¦±</span>ï¼Œè–å…‰ç‘ä¸‹ï¼Œæ¢å¾© <span class="status-positive">10 HP</span>ï¼', true);
                } else {
                    display('ä½ <span class="action">ç¥ˆç¦±</span>ç„¡æœï¼Œå¤©ç©ºæ¯«ç„¡å›æ‡‰ã€‚', true);
                }
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        updatePlayerHpBar();
                        updatePlayerPanel();
                        enemyTurn();
                    }, 1000);
                }, 1000);
            }, 300);
        }
    }
];

        const combatActions = {
    'æ”»æ“Š': 'ä½¿ç”¨æ­¦å™¨å°æ•µäººé€ æˆåŸºç¤å‚·å®³ï¼Œæ ¹æ“šæ”»æ“ŠåŠ›å’Œæ•µäººé˜²ç¦¦è¨ˆç®—ã€‚',
    'é˜²ç¦¦å§¿æ…‹': 'é€²å…¥é˜²ç¦¦ç‹€æ…‹ï¼Œä¸‹å›åˆå—åˆ°çš„å‚·å®³æ¸›åŠã€‚',
    'ä½¿ç”¨ç«ç„°é­”æ³•': 'é‡‹æ”¾ç«ç„°æ”»æ“Šï¼Œé€ æˆé¡å¤–å‚·å®³ä¸¦å¯èƒ½å¼•ç™¼ç‡ƒç‡’æ•ˆæœï¼ˆé™ä½æ•µäººé˜²ç¦¦ï¼‰ã€‚',
    'ä½¿ç”¨å†°å‡é­”æ³•': 'å¬å–šå¯’éœœï¼Œé™ä½æ•µäººæ”»æ“ŠåŠ›ï¼Œä½¿ç”¨æ¬¡æ•¸æœ‰é™ã€‚',
    'ä½¿ç”¨é›·é›»é­”æ³•': 'é‡‹æ”¾é›·é›»ï¼Œ50%å‘½ä¸­ç‡ï¼Œå‘½ä¸­æ™‚é€ æˆé«˜é¡å‚·å®³ã€‚',
    'ä½¿ç”¨æ²»ç™‚è—¥æ°´': 'é£²ç”¨è—¥æ°´æ¢å¾©20 HPï¼Œä¸¦æ¸…é™¤ä¸­æ¯’ç‹€æ…‹ï¼ˆéœ€æŒæœ‰è—¥æ°´ï¼‰ã€‚',
    'ä½¿ç”¨ç‚¸å½ˆ': 'æŠ•æ“²ç‚¸å½ˆï¼Œå°æ•µäººé€ æˆ50é»å›ºå®šå‚·å®³ï¼ˆéœ€æŒæœ‰ç‚¸å½ˆï¼‰ã€‚',
    'é€ƒè·‘': 'è©¦åœ–é€ƒé›¢æˆ°é¬¥ï¼Œ60%æˆåŠŸç‡ï¼Œå¤±æ•—å‰‡æ•µäººç«‹åˆ»åæ“Šã€‚'
};

        function showTitleScreen() {
    titleScreen.style.display = 'flex';
    gameContent.style.display = 'none';
    
    // ç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨ï¼ˆé¿å…é‡è¤‡ç¶å®šï¼‰
    startButton.removeEventListener('click', startGameHandler);
    // å®šç¾©äº‹ä»¶è™•ç†å‡½æ•¸
    function startGameHandler() {
        const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/03/skill-change.mp3';
        playSoundWithVolume(soundUrl);
        titleScreen.style.display = 'none';
        gameContent.style.display = 'block';
        startGame();
    }
    // åªç¶å®šä¸€æ¬¡
    startButton.addEventListener('click', startGameHandler, { once: true });
}
        function display(text, isPlayerAction = false) {
            const p = document.createElement('p');
            p.innerHTML = text;
            p.style.opacity = '0'; // åˆå§‹è¨­ç‚ºé€æ˜
            output.appendChild(p);
            output.scrollTop = output.scrollHeight;
            if (isPlayerAction) {
                setTimeout(() => {
                    p.classList.add('bounce-in');
                    setTimeout(() => {
                        p.style.opacity = '1';
                    }, 500); // èˆ‡ bounceIn å‹•ç•«æ™‚é–“ä¸€è‡´
                }, 500); // ç©å®¶è¡Œå‹•æ–‡å­—å»¶é² 0.5 ç§’å½ˆå…¥
            } else {
                setTimeout(() => {
                    p.classList.add('bounce-in');
                    setTimeout(() => {
                        p.style.opacity = '1';
                    }, 500); // èˆ‡ bounceIn å‹•ç•«æ™‚é–“ä¸€è‡´
                }, 500); // æ€ªç‰©è¡Œå‹•æ–‡å­—å»¶é² 0.5 ç§’å½ˆå…¥
            }
        }

        // æ·»åŠ  clearOutput å‡½æ•¸
        function clearOutput() {
            const paragraphs = output.querySelectorAll('p');
            paragraphs.forEach(p => {
                p.classList.remove('bounce-in'); // ç§»é™¤ bounce-in ä»¥é¿å…è¡çª
                p.classList.add('fade-out');
                setTimeout(() => {
                    p.remove(); // å‹•ç•«å®Œæˆå¾Œç§»é™¤
                }, 500); // èˆ‡ fadeOut å‹•ç•«æ™‚é–“ä¸€è‡´
            });
        }
        function clearChoices() {
            choices.innerHTML = '';
            playerImage.classList.remove('shake-up'); // åœæ­¢æˆ°é¬¥çµæŸæ™ƒå‹•
        }

        function addChoice(text, callback) {
            const button = document.createElement('button');
            button.innerHTML = text.replace(/Ë¢á´¾ (.*)/, '<span class="special-action">$1</span>');
            
            // å¦‚æœæ˜¯ç‰¹æ®Šè¡Œå‹•ï¼Œæ·»åŠ  special-action-button é¡åˆ¥
            if (text.startsWith('Ë¢á´¾ ')) {
                button.classList.add('special-action-button');
            }
        
            if (player.sealedAction && text.includes(player.sealedAction)) {
                button.disabled = true;
                button.style.opacity = '0.5';
                button.style.cursor = 'not-allowed';
            }
            if (text === '<span class="action">ä½¿ç”¨å†°å‡é­”æ³•</span>' && player.iceMagicUses >= 2) {
                button.disabled = true;
                button.style.opacity = '0.5';
                button.style.cursor = 'not-allowed';
            }
            button.onclick = () => {
                clearOutput();
                setTimeout(() => {
                    callback();
                }, 500);
            };
        
            // é•·æŒ‰æª¢æ¸¬
            let longPressTimer;
            button.addEventListener('mousedown', startLongPress);
            button.addEventListener('touchstart', startLongPress, { passive: true });
            button.addEventListener('mouseup', endLongPress);
            button.addEventListener('touchend', endLongPress);
            button.addEventListener('mouseleave', endLongPress);
            button.addEventListener('touchcancel', endLongPress);
        
            function startLongPress(e) {
                longPressTimer = setTimeout(() => {
                    showActionInfo(text);
                }, 500);
            }
        
            function endLongPress() {
                clearTimeout(longPressTimer);
            }
        
            choices.appendChild(button);
        }

        function showActionInfo(actionText) {
            let info = '';
            const cleanText = actionText.replace(/<span class="action">|<\/span>/g, '');
            if (floorActions[cleanText]) {
                info = `<strong>${cleanText}</strong><br>${floorActions[cleanText]}`;
            } else if (combatActions[cleanText]) {
                info = `<strong>${cleanText}</strong><br>${combatActions[cleanText]}`;
            } else if (cleanText.startsWith('Ë¢á´¾ ')) {
                const specialName = cleanText.replace('Ë¢á´¾ ', '');
                const special = specialActions.find(s => s.name === specialName);
                if (special) {
                    info = `<strong>${special.name}</strong><br>${special.desc}`;
                }
            } else if (rewards.find(r => r.name === cleanText)) {
                const reward = rewards.find(r => r.name === cleanText);
                info = `<strong>${reward.name}</strong><br>${reward.desc}`;
            } else if (merchantOptions[cleanText]) {
                info = `<strong>${cleanText}</strong><br>${merchantOptions[cleanText]}`;
            }
        
            if (info) {
                infoBox.innerHTML = info;
                infoBox.style.display = 'block';
                setTimeout(() => infoBox.classList.add('visible'), 10); // å»¶é²æ·»åŠ é¡åˆ¥ä»¥è§¸ç™¼å‹•ç•«
            }
        }
        
        function showEnemyInfo(enemyData) {
            infoBox.innerHTML = `
                <img src="${enemy.image}" alt="${enemy.name}">
                <strong>${enemy.name}</strong>
                <div class="stats-grid">
                    <span>HP: ${enemy.hp}/${enemy.maxHp}</span>
                    <span>æ”»æ“Š: ${enemy.attack}</span>
                    <span>é˜²ç¦¦: ${enemy.defense}</span>
                    <span>ç‰¹æ€§: ${enemy.specialDesc}</span>
                    <span>ç¶“é©—å€¼: ${enemy.exp}</span>
                    <span>é‡‘å¹£: ${enemy.gold}</span>
                </div>
                <div class="story">
                    <p>${enemy.story.split('ã€‚')[0]}ã€‚</p>
                    <p>${enemy.story.split('ã€‚')[1]}ã€‚</p>
                    <p>${enemy.story.split('ã€‚')[2]}ã€‚</p>
                </div>
            `;
            infoBox.style.display = 'block';
            setTimeout(() => infoBox.classList.add('visible'), 10);
        }
        
        // æ›´æ–°å¤–éƒ¨é»æ“Šé—œé–‰é‚è¼¯
        document.addEventListener('click', (e) => {
            if (!infoBox.contains(e.target) && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'IMG') {
                infoBox.classList.remove('visible');
                setTimeout(() => infoBox.style.display = 'none', 300); // ç­‰å¾…æ·¡å‡ºå‹•ç•«å®Œæˆ
            }
        });

        function updatePlayerHpBar() {
            const percentage = (player.hp / player.maxHp) * 100;
            playerHpBar.style.width = `${percentage}%`;
            playerHpText.textContent = `${player.hp}/${player.maxHp}`;
        }

        function updateEnemyHpBar() {
            if (!enemy) {
                enemyHpBar.style.width = '0%';
                enemyHpText.textContent = '';
                enemyImage.innerHTML = '';
                return;
            }
            const percentage = (enemy.hp / enemy.maxHp) * 100;
            enemyHpBar.style.width = `${percentage}%`;
            enemyHpText.textContent = `${enemy.hp}/${enemy.maxHp}`;
        }

        function setEnemyImage(enemyName) {
            if (enemy && enemy.image) {
                enemyImage.innerHTML = `<img src="${enemy.image}" alt="${enemyName}" onerror="this.onerror=null; this.src='https://via.placeholder.com/80x65?text=Enemy'">`;
            } else {
                enemyImage.innerHTML = `<img src="https://via.placeholder.com/80x65?text=Enemy" alt="Default Enemy">`;
            }
            enemyImage.onclick = () => showEnemyInfo(enemy); // ç›´æ¥å‚³å…¥ç•¶å‰ enemy
        }

document.addEventListener('click', (e) => {
    if (!infoBox.contains(e.target) && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'IMG') {
        infoBox.style.display = 'none';
    }
});function setEnemyImage(enemyName) {
    const enemyData = enemies.find(e => e.name === enemyName);
    if (enemyData && enemyData.image) {
        enemyImage.innerHTML = `<img src="${enemyData.image}" alt="${enemyName}" onerror="this.onerror=null; this.src='https://via.placeholder.com/80x65?text=Enemy'">`;
    } else if (enemy && enemy.image) {
        enemyImage.innerHTML = `<img src="${enemy.image}" alt="${enemyName}" onerror="this.onerror=null; this.src='https://via.placeholder.com/80x65?text=Enemy'">`;
    } else {
        enemyImage.innerHTML = `<img src="https://via.placeholder.com/80x65?text=Enemy" alt="Default Enemy">`;
    }

    enemyImage.onclick = () => showEnemyInfo(enemyData || enemy);
}

document.addEventListener('click', (e) => {
    if (!infoBox.contains(e.target) && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'IMG') {
        infoBox.style.display = 'none';
    }
});

        function updatePlayerPanel() {
            playerHpBar.style.width = `${(player.hp / player.maxHp) * 100}%`;
            playerHpText.textContent = `${player.hp}/${player.maxHp}`;
            document.getElementById('playerAttack').textContent = player.attack + player.tempStats.attack;
            document.getElementById('playerDefense').textContent = player.defense + player.tempStats.defense;
            document.getElementById('playerLevel').textContent = player.level;
            document.getElementById('playerExp').textContent = player.exp;
            document.getElementById('playerExpToNext').textContent = player.expToNextLevel;
            document.getElementById('playerGold').textContent = player.gold;
            document.getElementById('playerActionsLeft').textContent = actionsLeft;

            // æ›´æ–°è©³ç´°è³‡è¨Š
            document.getElementById('playerHpDetail').textContent = `${player.hp}/${player.maxHp}`;
            document.getElementById('playerCritChance').textContent = `${(player.critChance * 100).toFixed(0)}%`;
            document.getElementById('playerDodgeChance').textContent = `${(player.dodgeChance * 100).toFixed(0)}%`;
            document.getElementById('playerMagic').innerHTML = player.magic.length > 0 ? player.magic.map(item => `<span class="highlight">${item.split(' (')[0]}</span> (${item.split(' (')[1]}`).join(', ') : 'ç„¡';
            document.getElementById('playerItems').innerHTML = player.items.length > 0 ? player.items.map(item => `<span class="highlight">${item.split(' (')[0]}</span> (${item.split(' (')[1]}`).join(', ') : 'ç„¡';
            document.getElementById('playerEnhancements').innerHTML = player.enhancements.length > 0 ? player.enhancements.map(item => `<span class="highlight">${item.split(' (')[0]}</span> (${item.split(' (')[1]}`).join(', ') : 'ç„¡';
            document.getElementById('playerEquipment').innerHTML = player.equipment.length > 0 ? player.equipment.map(item => `<span class="highlight">${item.split(' (')[0]}</span> (${item.split(' (')[1]}`).join(', ') : 'ç„¡';
            document.getElementById('playerStatus').innerHTML = player.status.length > 0 ? player.status.map(s => `<span class="${s === 'ç¥ç¦' ? 'status-positive' : 'status-negative'}">${s}</span>`).join(', ') : 'æ­£å¸¸';
            document.getElementById('playerImmunities').textContent = player.immunities.length > 0 ? player.immunities.join(', ') : 'ç„¡';
        }

        function shakeScreen() {
            gameContainer.classList.add('shake');
            setTimeout(() => gameContainer.classList.remove('shake'), 200);
        }

        function flashScreen() {
            gameContainer.classList.add('flash');
            setTimeout(() => gameContainer.classList.remove('flash'), 500);
        }

        function checkGameOver() {
            if (player.hp <= 0) {
                display('ä½ çš„èº«é«”å†ä¹Ÿæ”¯æ’ä¸ä½ï¼Œé®®è¡€æŸ“ç´…åœ°é¢ï¼Œé»‘æš—åå™¬äº†ä½ çš„æ„è­˜â€¦â€¦<span class="action">éŠæˆ²çµæŸ</span>ã€‚');
                gameState = 'end';
                clearChoices();
                addChoice('é‡æ–°é–‹å§‹', () => location.reload());
                addChoice('è¼‰å…¥é€²åº¦', loadGame);
                return true;
            }
            return false;
        }

        function applyStatus(status, turns) {
            if (!player.status.includes(status) && !player.immunities.includes(status)) {
                player.status.push(status);
                statusTurns[status] = turns;
                display(`ä½ é™·å…¥<span class="status-negative">${status}</span>ç‹€æ…‹ï¼`);
            }
        }

        function updateStatus() {
            for (let status in statusTurns) {
                if (player.status.includes(status)) {
                    statusTurns[status]--;
                    if (statusTurns[status] <= 0) {
                        player.status = player.status.filter(s => s !== status);
                        delete statusTurns[status];
                        display(`<span class="status-${status === 'ç¥ç¦' ? 'positive' : 'negative'}">${status}</span>æ•ˆæœæ¶ˆå¤±ï¼`);
                    }
                }
            }
            updatePlayerPanel();
        }

        function upgradeEquipment(name, desc, value) {
            const existing = player.equipment.find(item => item.startsWith(name));
            if (existing) {
                const level = parseInt(existing.match(/Lv\.(\d+)/)?.[1] || 1) + 1;
                player.equipment = player.equipment.filter(item => !item.startsWith(name));
                player.equipment.push(`${name} Lv.${level} (${desc.replace(/\d+/, parseInt(desc.match(/\d+/)?.[0] || 0) + value)})`);
                if (desc.includes('æ”»æ“Š')) player.attack += value;
                if (desc.includes('é˜²ç¦¦')) player.defense += value;
                display(`ä½ çš„<span class="highlight">${name}</span>å‡ç´šç‚º Lv.${level}ï¼Œæ•ˆæœå¢å¼·ï¼`);
            } else {
                player.equipment.push(`${name} Lv.1 (${desc})`);
                if (desc.includes('æ”»æ“Š')) player.attack += value;
                if (desc.includes('é˜²ç¦¦')) player.defense += value;
                player.inventory.push(name);
            }
            updatePlayerPanel();
        }

        function upgradeMagic(name, desc, value) {
            const existing = player.magic.find(item => item.startsWith(name));
            if (existing) {
                const level = parseInt(existing.match(/Lv\.(\d+)/)?.[1] || 1) + 1;
                player.magic = player.magic.filter(item => !item.startsWith(name));
                let newDesc = desc;
                if (desc.includes('æ”»æ“Š +')) newDesc = `æ”»æ“Š +${parseInt(desc.match(/\d+/)?.[0] || 0) + 5}${desc.includes('ç¼ç‡’') ? ' & ç¼ç‡’' : ''}${desc.includes('50%å‘½ä¸­') ? ' (50%å‘½ä¸­)' : ''}`;
                if (desc.includes('é™ä½æ•µäººæ”»æ“Š')) newDesc = `é™ä½æ•µäººæ”»æ“Š (æ•ˆæœæå‡${Math.round((1 - value) * 100)}%)`;
                player.magic.push(`${name} Lv.${level} (${newDesc})`);
                display(`ä½ çš„<span class="highlight">${name}</span>å‡ç´šç‚º Lv.${level}ï¼Œæ•ˆæœå¢å¼·ï¼`);
            } else {
                player.magic.push(`${name} Lv.1 (${desc})`);
                player.inventory.push(name);
            }
            updatePlayerPanel();
        }

        function upgradeAccessory(name, desc, value, property) {
            const existing = player.equipment.find(item => item.startsWith(name));
            if (existing) {
                const level = parseInt(existing.match(/Lv\.(\d+)/)?.[1] || 1) + 1;
                player.equipment = player.equipment.filter(item => !item.startsWith(name));
                let newDesc = desc;
                if (desc.includes('çˆ†æ“Šç‡') || desc.includes('è¿´é¿ç‡')) {
                    const newValue = parseFloat(desc.match(/\d+/)?.[0] || 0) + (value * 100);
                    newDesc = desc.replace(/\d+%/, `${newValue}%`);
                    player[property] += value;
                } else if (desc.includes('å…ç–«')) {
                    newDesc = desc;
                }
                player.equipment.push(`${name} Lv.${level} (${newDesc})`);
                display(`ä½ çš„<span class="highlight">${name}</span>å‡ç´šç‚º Lv.${level}ï¼Œæ•ˆæœå¢å¼·ï¼`);
            } else {
                player.equipment.push(`${name} Lv.1 (${desc})`);
                if (desc.includes('çˆ†æ“Šç‡')) player.critChance += value;
                if (desc.includes('è¿´é¿ç‡')) player.dodgeChance += value;
                if (desc.includes('å…ç–«')) player.immunities.push(value);
                player.inventory.push(name);
            }
            updatePlayerPanel();
        }

        function saveGame() {
            const saveData = { player, currentFloor, actionsLeft, exploreCount, bossDefeatedCount };
            localStorage.setItem('roguelikeSave', JSON.stringify(saveData));
            display('é€²åº¦å·²è‡ªå‹•ä¿å­˜ï¼');
        }

        function loadGame() {
    const saveData = localStorage.getItem('roguelikeSave');
    if (saveData) {
        const data = JSON.parse(saveData);
        player = data.player;
        currentFloor = data.currentFloor;
        actionsLeft = data.actionsLeft;
        exploreCount = data.exploreCount;
        bossDefeatedCount = data.bossDefeatedCount || 0;
        baseStats = { attack: player.attack, defense: player.defense, hp: player.hp };
        display('å¤è€çš„é­”æ³•å·è»¸é–ƒçˆå…‰èŠ’ï¼Œä½ çš„å†’éšªæ—…ç¨‹å¾è¨˜æ†¶ä¸­å¾©ç”¦ï¼Œå·²è¼‰å…¥ä¿å­˜çš„é€²åº¦ï¼');
        updatePlayerHpBar();
        updatePlayerPanel();
        showFloorOptions();
    } else {
        display('æœªæ‰¾åˆ°å­˜æª”ï¼Œè«‹é–‹å§‹æ–°çš„å†’éšªï¼');
        clearChoices();
        addChoice('å›åˆ°æ¨™é¡Œç•«é¢', showTitleScreen);
    }
}

function startGame() {
    display(`ä½ æ˜¯ä¸€åå­¤ç¨çš„é¨å£«ï¼Œæ›¾ç¶“å®ˆè­·ç‹åœ‹é‚Šå¢ƒï¼Œä½†é­”ç‹çš„å´›èµ·æ‘§æ¯€äº†ä½ çš„å®¶åœ’ã€‚ä½ ç™¼èª“è¦å¾©ä»‡ï¼Œå¸¶è‘—ç ´èˆŠçš„ç›”ç”²å’Œä¸€é¡†å …å®šçš„å¿ƒï¼Œè¸å…¥é­”ç‹åŸï¼Œå°‹æ‰¾æ•‘è´–èˆ‡æ¦®è€€ã€‚<br><br>æ·±å¸ä¸€å£æ°£å¾Œï¼Œä½ è¸å…¥<span class="highlight">é­”ç‹åŸ</span>é‚£é™°æ£®æ£®çš„å¤§é–€ï¼Œè…æœ½çš„æ°£æ¯æ’²é¢è€Œä¾†ï¼ŒæœªçŸ¥çš„å±éšªåœ¨é»‘æš—ä¸­æ½›ä¼ã€‚<br><br>ä½ æ¡ç·Šæ‰‹ä¸­çš„æ­¦å™¨ï¼Œæº–å‚™è¿æ¥å‘½é‹çš„è€ƒé©— - HP: ${player.hp}/${player.maxHp}, æ”»æ“Š: ${player.attack}, é˜²ç¦¦: ${player.defense}`);
    gameState = 'floor';
    actionsLeft = 3;
    exploreCount = 0;
    bossDefeatedCount = 0;
    clearChoices();
    addChoice('é–‹å§‹å†’éšª', () => {
        if (!backgroundMusic) {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/Echoes-of-the-Abyss-ext-v2.mp3';
            backgroundMusic = new Audio(soundUrl);
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.2;
            backgroundMusic.play().catch(error => {
                console.error('èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾å¤±æ•—:', error);
            });
        }
        showFloorOptions();
    });
    addChoice('è¼‰å…¥é€²åº¦', loadGame);
    updatePlayerHpBar();
    updatePlayerPanel();
    updateEnemyHpBar();

    // ç‚ºç©å®¶åœ–ç‰‡ç¶å®šé»æ“Šäº‹ä»¶
    playerImage.onclick = () => showPlayerInfo();
}
// æ–°å¢é¡¯ç¤ºç©å®¶è³‡è¨Šçš„å‡½æ•¸
function showPlayerInfo() {
    infoBox.innerHTML = `
        <img src="${player.image}" alt="${player.name}">
        <strong>${player.name}</strong>
        <div class="stats-grid">
            <span>HP: ${player.hp}/${player.maxHp}</span>
            <span>æ”»æ“Š: ${player.attack + player.tempStats.attack}</span>
            <span>é˜²ç¦¦: ${player.defense + player.tempStats.defense}</span>
            <span>é‡‘å¹£: ${player.gold}</span>
            <span>ç­‰ç´š: ${player.level}</span>
            <span>ç¶“é©—: ${player.exp}/${player.expToNextLevel}</span>
            <span>çˆ†æ“Šç‡: ${(player.critChance * 100).toFixed(0)}%</span>
            <span>è¿´é¿ç‡: ${(player.dodgeChance * 100).toFixed(0)}%</span>
        </div>
        <details>
            <summary>æ›´å¤šè³‡è¨Š</summary>
            <p>é­”æ³•: ${player.magic.length > 0 ? player.magic.join(', ') : 'ç„¡'}</p>
            <p>é“å…·: ${player.items.length > 0 ? player.items.join(', ') : 'ç„¡'}</p>
            <p>å¼·åŒ–: ${player.enhancements.length > 0 ? player.enhancements.join(', ') : 'ç„¡'}</p>
            <p>è£å‚™: ${player.equipment.length > 0 ? player.equipment.join(', ') : 'ç„¡'}</p>
            <p>ç‹€æ…‹: ${player.status.length > 0 ? player.status.map(s => `<span class="${s === 'ç¥ç¦' ? 'status-positive' : 'status-negative'}">${s}</span>`).join(', ') : 'æ­£å¸¸'}</p>
            <p>å…ç–«: ${player.immunities.length > 0 ? player.immunities.join(', ') : 'ç„¡'}</p>
        </details>
        <div class="story">
            <p>åœ¨ç‹åœ‹é‚Šå¢ƒçš„é¢¨éœœä¸­ï¼Œä½ æ›¾æ˜¯ç„¡äººä¸çŸ¥çš„å®ˆè­·è€…ï¼Œæ‰‹æŒé•·åŠå®ˆæœ›è‘—å’Œå¹³çš„æ­²æœˆã€‚æ¯ç•¶å¤œå¹•é™è‡¨ï¼Œæ‘è½çš„ç‡ˆç«æ˜¯ä½ å¿ƒä¸­çš„æ…°è—‰ã€‚</p>
            <p>ç„¶è€Œï¼Œé‚£å€‹è¡€è…¥çš„å¤œæ™šï¼Œé­”ç‹çš„è»åœ˜å¦‚æ½®æ°´èˆ¬æ¹§ä¾†ï¼Œç«ç„°åå™¬äº†ä½ çš„æ•…é„‰ï¼Œè¦ªäººçš„å“­å–Šåœ¨è€³é‚Šå›éŸ¿ã€‚ä½ è·ªåœ¨å»¢å¢Ÿä¸­ï¼Œæ¡ç·Šæ–·è£‚çš„åŠåˆƒï¼Œç«‹ä¸‹èª“è¨€ï¼šä¸æƒœä¸€åˆ‡ä»£åƒ¹ï¼Œä¹Ÿè¦è®“é­”ç‹ä»˜å‡ºè¡€å‚µã€‚</p>
            <p>å¦‚ä»Šï¼Œå­¤èº«ä¸€äººçš„ä½ è¸å…¥é€™ç‰‡è©›å’’ä¹‹åœ°ï¼Œç›”ç”²ä¸Šçš„æ¯ä¸€é“å‚·ç—•ï¼Œéƒ½æ˜¯ä½ ä¸å±ˆçš„è­‰æ˜ã€‚</p>
        </div>
    `;
    infoBox.style.display = 'block';
    setTimeout(() => infoBox.classList.add('visible'), 10);
}
// åˆå§‹åŒ–æ¨™é¡Œç•«é¢
showTitleScreen();
        
        // ç‚ºæ‰€æœ‰éŸ³æ•ˆè¨­ç½®çµ±ä¸€éŸ³é‡ï¼ˆç¯„ä¾‹ï¼š0.5ï¼‰
        function playSoundWithVolume(soundUrl) {
            if (soundUrl) {
                const audio = new Audio(soundUrl);
                audio.volume = 1; // è¨­ç½®çŸ­æš«éŸ³æ•ˆéŸ³é‡ç‚º 50%
                audio.play().catch(error => {
                    console.error('éŸ³æ•ˆæ’­æ”¾å¤±æ•—:', error);
                });
            }
        }

        function showFloorOptions() {
    saveGame();
    display(`ä½ ä½æ–¼ç¬¬ ${currentFloor} å±¤ï¼Œé‚„æœ‰ ${actionsLeft} æ¬¡è¡Œå‹•å¯åŸ·è¡Œã€‚è«‹é¸æ“‡ä½ çš„è¡Œå‹•ï¼š`);
    gameState = 'floor';
    clearChoices();
    addChoice('<span class="action">æ¢ç´¢</span>', explore);
    addChoice('<span class="action">æ•´å‚™</span>', prepare);
    addChoice('<span class="action">è¨“ç·´</span>', train);
    if (actionsLeft <= 0) {
        enterNextFloorBattle();
    }
}

        function explore() {
            if (exploreCount >= 2) {
                display('ä½ å·²ç¶“æ¢ç´¢äº†å…©æ¬¡ï¼Œç„¡æ³•å†æ¬¡æ¢ç´¢ï¼');
                showFloorOptions();
                return;
            }
            exploreCount++;
            actionsLeft--;
            const rand = Math.random();
            let selectedEvent;
            if (rand < 0.75) selectedEvent = exploreEvents[0];
            else if (rand < 0.80) selectedEvent = exploreEvents[1];
            else if (rand < 0.85) selectedEvent = exploreEvents[2];
            else selectedEvent = exploreEvents[3];
            display(`ä½ æ±ºå®šæ¢ç´¢é­”ç‹åŸçš„æ·±è™•ï¼Œé­é‡äº†${selectedEvent.name}ï¼`);
            selectedEvent.action();
        }

        function prepare() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/04/dice.mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            actionsLeft--;
            player.hp = Math.min(player.maxHp, player.hp + 15);
            player.status = player.status.filter(s => s !== 'ä¸­æ¯’' && s !== 'æµè¡€' && s !== 'è©›å’’' && s !== 'ç‡ƒç‡’' && s !== 'å‡çµ');
            for (let s in statusTurns) delete statusTurns[s];
            display('ä½ æ‰¾äº†ä¸€å€‹å®‰å…¨çš„è§’è½ï¼Œæ•´ç†è£å‚™ä¸¦ä¼‘æ¯ç‰‡åˆ»ï¼Œæ¢å¾© <span class="status-positive">15 HP</span>ï¼Œä¸¦æ¸…é™¤äº†æ‰€æœ‰ç•°å¸¸ç‹€æ…‹ã€‚');
            updatePlayerHpBar();
            updatePlayerPanel();
            afterAction();
        }

        function train() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/01/dragon-5.mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            actionsLeft--;
            const isBigSuccess = Math.random() < 0.25;
            const attackBoost = isBigSuccess ? (Math.random() < 0.5 ? 2 : 0) : (Math.random() < 0.5 ? 1 : 0);
            const defenseBoost = isBigSuccess ? 2 : 1;
            const hpBoost = 5;

            player.attack += attackBoost;
            player.defense += defenseBoost;
            player.maxHp += hpBoost;
            player.hp = Math.min(player.maxHp, player.hp + hpBoost);

            if (isBigSuccess) {
                display(`ä½ åœ¨é­”ç‹åŸçš„ç©ºåœ°ä¸Šé€²è¡Œåˆ»è‹¦è¨“ç·´ï¼Œå¤§æˆåŠŸï¼æ”»æ“Š${attackBoost > 0 ? 'æå‡ <span class="status-positive">' + attackBoost + ' é»</span>' : 'æœªæå‡'}ï¼Œé˜²ç¦¦æå‡ <span class="status-positive">${defenseBoost} é»</span>ï¼Œç”Ÿå‘½ä¸Šé™æå‡ <span class="status-positive">${hpBoost} é»</span>ï¼`);
            } else {
                display(`ä½ åœ¨é­”ç‹åŸçš„ç©ºåœ°ä¸Šé€²è¡Œè¨“ç·´ï¼Œæ”»æ“Š${attackBoost > 0 ? 'æå‡ <span class="status-positive">' + attackBoost + ' é»</span>' : 'æœªæå‡'}ï¼Œé˜²ç¦¦æå‡ <span class="status-positive">${defenseBoost} é»</span>ï¼Œç”Ÿå‘½ä¸Šé™æå‡ <span class="status-positive">${hpBoost} é»</span>ï¼`);
            }
            updatePlayerHpBar();
            updatePlayerPanel();
            afterAction();
        }

        function afterAction() {
            if (gameState !== 'end') {
                showFloorOptions();
            }
        }

        function enterNextFloorBattle() {
            display(`ä½ æº–å‚™é€²å…¥ç¬¬ ${currentFloor + 1} å±¤ï¼Œä½†å¿…é ˆå…ˆé€šéå®ˆè¡›çš„è©¦ç…‰ï¼`);
            baseStats = { attack: player.attack, defense: player.defense, hp: player.hp };
            encounterMonster();
        }

        function nextFloor() {
            saveGame();
            if (currentFloor >= 10) {
                finalBoss();
                return;
            }
            flashScreen();
            display(`ä½ å®Œæˆäº†ç¬¬ ${currentFloor} å±¤çš„æ‰€æœ‰è¡Œå‹•ï¼Œæº–å‚™å‰å¾€ä¸‹ä¸€å±¤ï¼`);
            currentFloor++;
            actionsLeft = 3;
            exploreCount = 0;
            clearChoices();
            addChoice('ç¹¼çºŒ', showFloorOptions);
            updatePlayerPanel();
        }

        function encounterMonster() {
            enemy = generateEnemy();
            enemy.maxHp = enemy.hp; // å·²ç¶“åœ¨ generateEnemy ä¸­è¨­ç½®ï¼Œé€™è¡Œå¯ç§»é™¤
            const enemySpan = `<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>`;
            display(`é»‘æš—ä¸­å‚³ä¾†ç•°æ¨£çš„è²éŸ¿ï¼Œ${enemy.eventDesc}ä¸€éš»${enemySpan}ç·©ç·©é€¼è¿‘ï¼Œæ•µäººå±¬æ€§ - HP: ${enemy.hp}, æ”»æ“Š: ${enemy.attack}, é˜²ç¦¦: ${enemy.defense}`);
            setEnemyImage(enemy.name);
            gameState = 'combat';
            showCombatOptions();
            updateEnemyHpBar();
        }

        function generateEnemy() {
            const base = enemies[Math.floor(Math.random() * enemies.length)];
            const multiplier = currentFloor * 0.5;
            return {
                name: base.name,
                hp: Math.floor(base.hp * (1 + multiplier)),
                maxHp: Math.floor(base.hp * (1 + multiplier)), // ç¢ºä¿ maxHp ä¹Ÿè¢«è¨­ç½®
                attack: Math.floor(base.attack * (1 + multiplier)),
                defense: Math.floor(base.defense * (1 + multiplier)),
                special: base.special,
                specialDesc: base.specialDesc, // æ·»åŠ ä¸­æ–‡ç‰¹æ€§æè¿°
                eventDesc: base.eventDesc, // æ·»åŠ é­é‡æè¿°
                story: base.story, // æ·»åŠ èƒŒæ™¯æ•…äº‹
                exp: Math.floor(base.exp * (1 + multiplier)),
                gold: Math.floor(base.gold * (1 + multiplier)),
                image: base.image
            };
        }

        function checkLevelUp() {
            while (player.exp >= player.expToNextLevel) {
                player.level++;
                player.exp -= player.expToNextLevel;
                player.expToNextLevel = Math.floor(player.expToNextLevel * 1.5);
                player.attack += 1;
                player.defense += 1;
                player.maxHp += 10;
                player.hp = player.maxHp;
                baseStats.attack = player.attack;
                baseStats.defense = player.defense;
                baseStats.hp = player.hp;
                display(`ä¸€è‚¡æš–æµæ¹§éå…¨èº«ï¼Œä½ å‡åˆ°äº†ç­‰ç´š ${player.level}ï¼æ”»æ“Š +1ï¼Œé˜²ç¦¦ +1ï¼Œç”Ÿå‘½ä¸Šé™ +10ï¼Œä¸¦å®Œå…¨æ¢å¾©ï¼`);
                updatePlayerHpBar();
                updatePlayerPanel();
            }
        }

        function showCombatOptions() {
    if (!enemy || (gameState !== 'combat' && gameState !== 'boss')) return;
    clearChoices();
    addChoice('<span class="action">æ”»æ“Š</span>', attackEnemy);
    addChoice('<span class="action">é˜²ç¦¦å§¿æ…‹</span>', defend);
    if (player.inventory.includes('æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)')) addChoice('<span class="action">ä½¿ç”¨æ²»ç™‚è—¥æ°´</span>', usePotion);
    if (player.inventory.includes('ç‚¸å½ˆ (50 å‚·å®³)')) addChoice('<span class="action">ä½¿ç”¨ç‚¸å½ˆ</span>', useBomb);
    player.magic.forEach(magic => {
        if (magic.startsWith('ç«ç„°é­”æ³•')) addChoice('<span class="action">ä½¿ç”¨ç«ç„°é­”æ³•</span>', useFireMagic);
        if (magic.startsWith('å†°å‡é­”æ³•')) addChoice('<span class="action">ä½¿ç”¨å†°å‡é­”æ³•</span>', useIceMagic);
        if (magic.startsWith('é›·é›»é­”æ³•')) addChoice('<span class="action">ä½¿ç”¨é›·é›»é­”æ³•</span>', useThunderMagic);
    });
    addChoice('<span class="action">é€ƒè·‘</span>', attemptEscape);

    const special = specialActions[Math.floor(Math.random() * specialActions.length)];
    addChoice(`Ë¢á´¾ ${special.name}`, special.action); // é€™è£¡æœƒè§¸ç™¼ special-action-button
}

        const attackDescriptions = [
            (damage) => `ä½ æ®èˆæ­¦å™¨ï¼ŒåŠƒç ´ç©ºæ°£ï¼Œç‹ ç‹ ç å‘<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>ï¼Œé€ æˆ ${damage} é»å‚·å®³ï¼`,
            (damage) => `ä½ æ€’å¼ä¸€è²ï¼Œæ‰‹ä¸­åˆ©åˆƒé–ƒçˆå¯’å…‰ï¼Œåˆºå…¥<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>çš„èº«è»€ï¼Œé®®è¡€é£›æ¿ºï¼Œé€ æˆäº† ${damage} é»å‚·å®³ï¼`
        ];

        const critDescriptions = [
            (damage) => `ä½ æ‰¾åˆ°ç ´ç¶»ï¼Œ<span class="action">è‡´å‘½ä¸€æ“Š</span>ï¼æ­¦å™¨ç„¡è¦–é˜²ç¦¦æ·±æ·±åµŒå…¥<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>çš„è¦å®³ï¼Œçˆ†æ“Šé€ æˆ ${damage} é»å‚·å®³ï¼`
        ];

        function attackEnemy() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/03/hp-decrease.mp3';
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            defending = false;
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                let totalDamage = 0;
                let attacks = player.dodgeChance > 0 ? 2 : 1;
                for (let i = 0; i < attacks; i++) {
                    let damage = player.attack + player.tempStats.attack;
                    const isCrit = Math.random() < player.critChance;
                    if (isCrit) {
                        damage = Math.floor(damage * 1.5);
                        damage = Math.max(1, damage);
                        display(critDescriptions[Math.floor(Math.random() * critDescriptions.length)](damage), true);
                    } else {
                        damage = Math.max(1, damage - enemy.defense);
                        if (player.status.includes('è©›å’’')) damage = Math.floor(damage * 0.7);
                        display(attackDescriptions[Math.floor(Math.random() * attackDescriptions.length)](damage), true);
                    }
                    totalDamage += damage;
                }
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        enemy.hp -= totalDamage;
                        display(`æ•µäºº HP: ${enemy.hp}`);
                        updateEnemyHpBar();
                        if (enemy.hp <= 0) {
                            winCombat();
                        } else {
                            enemyTurn();
                        }
                    }, 500);
                }, 500);
            }, 300);
        }
        function defend() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/05/é˜²ç¦¦.mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            defending = true;
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                display('ä½ é›™æ‰‹ç·Šæ¡æ­¦å™¨ï¼Œæ¶èµ·<span class="action">é˜²ç¦¦å§¿æ…‹</span>ï¼Œæº–å‚™è¿æ¥æ•µäººçš„çŒ›æ”»ï¼Œæ¸›å°‘å—åˆ°çš„å‚·å®³ã€‚', true);
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        enemyTurn();
                    }, 500); // ç¸®çŸ­ç‚º 0.5 ç§’
                }, 500); // ç¸®çŸ­ç‚º 0.5 ç§’
            }, 300);
        }

        function useFireMagic() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/firemagic.mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            defending = false;
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                const level = parseInt(player.magic.find(m => m.startsWith('ç«ç„°é­”æ³•'))?.match(/Lv\.(\d+)/)?.[1] || 1);
                let damage = Math.max(1, (player.attack + player.tempStats.attack) + 10 + (level - 1) * 5 - enemy.defense);
                const isCrit = Math.random() < player.critChance;
                if (isCrit) {
                    damage = Math.floor(damage * 1.5);
                    display(`ä½ é›™æ‰‹ç‡ƒèµ·ç†Šç†Šçƒˆç„°ï¼Œæœ<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>å°„å‡ºä¸€é“<span class="action">ç«é¾</span>ï¼Œçˆ†æ“Šç‡’ç„¦äº†å®ƒçš„èº«è»€ï¼Œé€ æˆ ${damage} é»å‚·å®³ï¼`, true);
                } else {
                    display(`ä½ ä½å–ä¸€è²ï¼Œ<span class="action">ç«ç„°</span>å¾æŒ‡å°–å™´æ¹§è€Œå‡ºï¼Œç‚™ç†±çš„ç«èˆŒèˆ”èˆè‘—<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>ï¼Œé€ æˆ ${damage} é»å‚·å®³ï¼`, true);
                }
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        enemy.hp -= damage;
                        applyStatus('ç‡ƒç‡’', 2);
                        enemy.defense = Math.max(0, enemy.defense - 5);
                        display(`<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>è¢«<span class="status-negative">ç¼ç‡’</span>ï¼Œé˜²ç¦¦ä¸‹é™ 5 é»ï¼`);
                        display(`æ•µäºº HP: ${enemy.hp}`);
                        updateEnemyHpBar();
                        if (enemy.hp <= 0) {
                            winCombat();
                        } else {
                            enemyTurn();
                        }
                    }, 500);
                }, 300);
            }, 300);
        }

        function useIceMagic() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/icemagic.mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            defending = false;
            if (player.iceMagicUses >= 2) {
                display(`<span class="action">å†°å‡é­”æ³•</span>å·²é€£çºŒä½¿ç”¨å…©æ¬¡ï¼Œéœ€å†·å» ${player.iceMagicCooldown} å›åˆï¼`);
                showCombatOptions();
                return;
            }
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                const level = parseInt(player.magic.find(m => m.startsWith('å†°å‡é­”æ³•'))?.match(/Lv\.(\d+)/)?.[1] || 1);
                const reduction = 0.7 - (level - 1) * 0.05;
                enemy.attack = Math.max(0, Math.floor(enemy.attack * reduction));
                display(`ä½ æ®æ‰‹å¬å–š<span class="action">å¯’éœœ</span>ï¼Œå†°å†·çš„æ°£æ¯ç± ç½©<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>ï¼Œå®ƒçš„å‹•ä½œè®Šå¾—é²ç·©ï¼Œæ”»æ“ŠåŠ›é™ä½è‡³ ${enemy.attack}ï¼`, true);
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        player.iceMagicUses++;
                        if (player.iceMagicUses === 2) player.iceMagicCooldown = 1;
                        enemyTurn();
                    }, 500);
                }, 300);
            }, 300);
        }

        function useThunderMagic() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/thundermagic.mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            defending = false;
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                const level = parseInt(player.magic.find(m => m.startsWith('é›·é›»é­”æ³•'))?.match(/Lv\.(\d+)/)?.[1] || 1);
                let damage = Math.max(1, (player.attack + player.tempStats.attack) + 15 + (level - 1) * 5 - enemy.defense);
                const isHit = Math.random() < 0.5;
                if (!isHit) {
                    display(`ä½ é‡‹æ”¾<span class="action">é›·é›»é­”æ³•</span>ï¼Œä½†é›»æµåé›¢äº†ç›®æ¨™ï¼Œæœªèƒ½æ“Šä¸­<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>ï¼`, true);
                    setTimeout(() => {
                        enemyImage.classList.add('shake-left');
                        setTimeout(() => {
                            enemyImage.classList.remove('shake-left');
                            enemyTurn();
                        }, 500);
                    }, 500);
                    return;
                }
                const isCrit = Math.random() < player.critChance;
                if (isCrit) {
                    damage = Math.floor(damage * 1.5);
                    display(`ä½ å¬å–š<span class="action">é›·é›»</span>ï¼Œä¸€é“é–ƒé›»åŠˆå‘<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>ï¼Œçˆ†æ“Šé€ æˆ ${damage} é»å‚·å®³ï¼`, true);
                } else {
                    display(`ä½ é‡‹æ”¾<span class="action">é›·é›»é­”æ³•</span>ï¼Œé›»æµæ“Šä¸­<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>ï¼Œé€ æˆ ${damage} é»å‚·å®³ï¼`, true);
                }
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        enemy.hp -= damage;
                        display(`æ•µäºº HP: ${enemy.hp}`);
                        updateEnemyHpBar();
                        if (enemy.hp <= 0) {
                            winCombat();
                        } else {
                            enemyTurn();
                        }
                    }, 500);
                }, 300);
            }, 300);
        }

        function usePotion() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/drink.mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            defending = false;
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                player.hp = Math.min(player.maxHp, player.hp + 20);
                player.items = player.items.filter(item => item !== 'æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)');
                player.inventory = player.inventory.filter(item => item !== 'æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)');
                if (player.status.includes('ä¸­æ¯’')) {
                    player.status = player.status.filter(s => s !== 'ä¸­æ¯’');
                    delete statusTurns['ä¸­æ¯’'];
                    display('ä½ é£²ä¸‹<span class="highlight">æ²»ç™‚è—¥æ°´</span>ï¼Œæ¯’ç´ è¢«æ¸…é™¤ï¼Œ<span class="status-negative">ä¸­æ¯’</span>è§£é™¤ï¼', true);
                } else {
                    display(`ä½ æå‡ºä¸€ç“¶ç¿ ç¶ çš„<span class="highlight">è—¥æ°´</span>ï¼Œä¸€é£²è€Œç›¡ï¼Œæº«æš–çš„èƒ½é‡æµéå…¨èº«ï¼Œæ¢å¾© <span class="status-positive">20 HP</span>ï¼Œç•¶å‰ HP: ${player.hp}/${player.maxHp}`, true);
                }
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        updatePlayerHpBar();
                        updatePlayerPanel();
                        enemyTurn();
                    }, 500);
                }, 300);
            }, 300);
        }

        function useBomb() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/05/æŠ€èƒ½2.mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            defending = false;
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                enemy.hp -= 50;
                player.items = player.items.filter(item => item !== 'ç‚¸å½ˆ (50 å‚·å®³)');
                player.inventory = player.inventory.filter(item => item !== 'ç‚¸å½ˆ (50 å‚·å®³)');
                display(`ä½ é»ç‡ƒ<span class="highlight">ç‚¸å½ˆ</span>çš„å¼•ç·šï¼Œæœ<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>æ‰”å»ï¼Œä¸€è²å·¨éŸ¿ï¼Œç«å…‰å››æ¿ºï¼Œé€ æˆ 50 é»æ¯€æ»…æ€§å‚·å®³ï¼æ•µäºº HP: ${enemy.hp}`, true);
                setTimeout(() => {
                    enemyImage.classList.add('shake-left');
                    setTimeout(() => {
                        enemyImage.classList.remove('shake-left');
                        updateEnemyHpBar();
                        updatePlayerPanel();
                        if (enemy.hp <= 0) {
                            winCombat();
                        } else {
                            enemyTurn();
                        }
                    }, 500);
                }, 300);
            }, 300);
        }

        function attemptEscape() {
            const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/05/é–ƒèº².mp3'; // é ç•™éŸ³æ•ˆ URL
            playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
            defending = false;
            playerImage.classList.add('shake-right');
            setTimeout(() => {
                playerImage.classList.remove('shake-right');
                if (Math.random() < 0.6) {
                    display('ä½ è½‰èº«<span class="action">é£›å¥”</span>ï¼Œè…³æ­¥å¦‚é¢¨ï¼Œçµ‚æ–¼ç”©é–‹äº†æ•µäººï¼Œå–˜æ¯è‘—é€ƒå‡ºç”Ÿå¤©ï¼', true);
                    setTimeout(() => {
                        enemyImage.classList.add('shake-left');
                        setTimeout(() => {
                            enemyImage.classList.remove('shake-left');
                            gameState = 'floor';
                            enemy = null;
                            updateEnemyHpBar();
                            afterAction();
                        }, 1000);
                    }, 1000);
                } else {
                    display(`ä½ è©¦åœ–<span class="action">é€ƒè·‘</span>ï¼Œä½†è…³ä¸‹ä¸€å€‹è¸‰è¹Œï¼Œ<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>å’†å“®è‘—æ’²äº†ä¸Šä¾†ï¼Œé€ƒè·‘å¤±æ•—ï¼`, true);
                    setTimeout(() => {
                        enemyImage.classList.add('shake-left');
                        setTimeout(() => {
                            enemyImage.classList.remove('shake-left');
                            enemyTurn();
                        }, 500);
                    }, 300);
                }
            }, 300);
        }

        const enemyAttackDescriptions = [
            (damage) => `<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>ç™¼å‡ºç˜®äººçš„å¼è²ï¼Œæ’²å‘ä½ ï¼Œåˆ©çˆªæ’•è£‚ä½ çš„é˜²ç¦¦ï¼Œé€ æˆ ${damage} é»å‚·å®³ï¼`
        ];

        const enemyPierceDescriptions = [
            (damage) => `<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>ç™¼å‹•ç„¡è¦–é˜²ç¦¦çš„è²«ç©¿æ”»æ“Šï¼Œç›´æ“Šä½ çš„è¦å®³ï¼Œé€ æˆ ${damage} é»å‚·å®³ï¼`
        ];

        function enemyTurn() {
            let damage;
            const isPierce = Math.random() < 0.25;
            if (isPierce) {
                damage = enemy.attack;
                if (defending) damage = Math.floor(damage * 0.5);
                display(enemyPierceDescriptions[Math.floor(Math.random() * enemyPierceDescriptions.length)](damage));
            } else {
                damage = Math.max(1, enemy.attack - (player.defense + player.tempStats.defense));
                if (defending) damage = Math.floor(damage * 0.5);
                if (player.status.includes('ç¥ç¦')) damage = Math.floor(damage * 0.8);
                display(enemyAttackDescriptions[Math.floor(Math.random() * enemyAttackDescriptions.length)](damage));
            }

            if (Math.random() < player.dodgeChance) {
                display(`ä½ éˆæ•åœ°é–ƒé¿ï¼Œ<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>çš„æ”»æ“Šè½ç©ºäº†ï¼`);
            } else {
                player.hp = Math.max(0, player.hp - damage);
                display(`ä½ çš„ HP: ${player.hp}/${player.maxHp}`);
            }

            if (enemy.special === 'poison' && Math.random() < 0.15 && !player.immunities.includes('poison')) {
                applyStatus('ä¸­æ¯’', 2);
            }
            if (enemy.special === 'bleed' && Math.random() < 0.15 && !player.status.includes('æµè¡€')) {
                applyStatus('æµè¡€', 2);
                display(`<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>çš„åˆ©çˆªåŠƒé–‹ä½ çš„è¡€è‚‰ï¼Œä½ é–‹å§‹<span class="status-negative">æµè¡€</span>ï¼Œæ¯å›åˆæå¤± 3 HPï¼`);
            }
            if (enemy.special === 'stun' && Math.random() < 0.1) {
                applyStatus('æšˆçœ©', 1);
                display(`<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>çš„å·¨åŠ›è®“ä½ é ­æšˆç›®çœ©ï¼Œä½ é€²å…¥<span class="status-negative">æšˆçœ©</span>ç‹€æ…‹ï¼Œä¸‹å›åˆç„¡æ³•è¡Œå‹•ï¼`);
            }
            if (enemy.special === 'leech') {
                const leech = Math.floor(damage * 0.5);
                enemy.hp = Math.min(enemy.maxHp, enemy.hp + leech);
                display(`<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>çš„ç ç‰™åˆºå…¥ä½ çš„è¡€è‚‰ï¼Œå¸å–ç”Ÿå‘½åŠ›ï¼Œæ¢å¾© <span class="status-positive">${leech} HP</span>ï¼`);
                updateEnemyHpBar();
            }
            if (enemy.special === 'curse' && Math.random() < 0.15 && !player.status.includes('è©›å’’')) {
                applyStatus('è©›å’’', 2);
                display(`<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>æ•£ç™¼è©­ç•°æ°£æ¯ï¼Œä½ æ„Ÿåˆ°åŠ›é‡è¢«å‰Šå¼±ï¼Œé€²å…¥<span class="status-negative">è©›å’’</span>ç‹€æ…‹ï¼`);
            }
            if (enemy.special === 'burn' && Math.random() < 0.15 && !player.immunities.includes('burn')) {
                applyStatus('ç‡ƒç‡’', 2);
                display(`<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>å™´å‡ºçƒˆç„°ï¼Œä½ è¢«<span class="status-negative">ç‡ƒç‡’</span>ï¼Œæ¯å›åˆæå¤± 4 HPï¼`);
            }
            if (enemy.special === 'freeze' && Math.random() < 0.15 && !player.status.includes('å‡çµ')) {
                applyStatus('å‡çµ', 2);
                display(`<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>é‡‹æ”¾å¯’æ°£ï¼Œä½ è¢«<span class="status-negative">å‡çµ</span>ï¼Œé˜²ç¦¦é™ä½ 2ï¼`);
            }

            if (player.status.includes('ä¸­æ¯’') && !player.immunities.includes('poison')) {
                player.hp = Math.max(0, player.hp - 5);
                display('<span class="status-negative">æ¯’æ¶²</span>åœ¨ä½ é«”å…§è‚†è™ï¼Œç–¼ç—›å¦‚é‡åˆºï¼Œæå¤± 5 HPï¼');
            }
            if (player.status.includes('æµè¡€')) {
                player.hp = Math.max(0, player.hp - 3);
                display('é®®è¡€å¾å‚·å£æ»²å‡ºï¼Œ<span class="status-negative">æµè¡€</span>è®“ä½ æå¤± 3 HPï¼');
            }
            if (player.status.includes('ç‡ƒç‡’') && !player.immunities.includes('burn')) {
                player.hp = Math.max(0, player.hp - 4);
                display('<span class="status-negative">ç«ç„°</span>ç¼ç‡’ä½ çš„èº«é«”ï¼Œæå¤± 4 HPï¼');
            }
            if (player.status.includes('å‡çµ')) {
                player.defense = Math.max(0, player.defense - 2);
                display('<span class="status-negative">å‡çµ</span>è®“ä½ çš„å‹•ä½œåƒµç¡¬ï¼Œé˜²ç¦¦é™ä½ 2ï¼');
            }

            updatePlayerHpBar();
            updatePlayerPanel();
            updateStatus();

            if (player.iceMagicCooldown > 0) {
                player.iceMagicCooldown--;
                if (player.iceMagicCooldown === 0) {
                    display('å†°å‡é­”æ³•å·²å†·å»å®Œæˆï¼');
                    player.iceMagicUses = 0;
                }
            }

            if (checkGameOver()) return;

            if (player.status.includes('æšˆçœ©')) {
                display('ä½ å› <span class="status-negative">æšˆçœ©</span>è€Œç„¡æ³•è¡Œå‹•ï¼');
                player.status = player.status.filter(s => s !== 'æšˆçœ©');
                delete statusTurns['æšˆçœ©'];
                updatePlayerPanel();
                enemyTurn();
            } else {
                setTimeout(() => {
                    showCombatOptions();
                }, 1500); // èª¿æ•´ç‚º 1.5 ç§’ï¼Œé…åˆ 0.5 ç§’é–“éš”
            }
        }

        function winCombat() {
            player.exp += enemy.exp;
            player.gold += enemy.gold;
            display(`éš¨è‘—ä¸€è²æ·’å²çš„å“€åšï¼Œ<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>å€’åœ¨è¡€æ³Šä¸­ï¼Œä½ æ“¦å»é¡ä¸Šçš„æ±—æ°´ï¼Œå–˜è‘—ç²—æ°£ï¼Œå‹åˆ©å±¬æ–¼ä½ ï¼ç²å¾— ${enemy.exp} ç¶“é©—å€¼å’Œ ${enemy.gold} é‡‘å¹£ã€‚`);
            checkLevelUp();
            if (enemy.name === 'é­”ç‹') {
                bossDefeatedCount++;
                if (bossDefeatedCount === 1) {
                    display('é­”ç‹ç™¼å‡ºéœ‡å¤©çš„å’†å“®ï¼Œèº«é«”æ•£ç™¼å‡ºé»‘æš—å…‰èŠ’ï¼Œé€²å…¥<span class="highlight">äºŒéšæ®µè¦ºé†’</span>ï¼');
                    enemy = { name: 'é­”ç‹', hp: 100, attack: 40, defense: 30, special: 'poison', desc: 'é­”ç‹è¦ºé†’å¾Œï¼Œå‘¨èº«ç± ç½©è‘—é»‘æš—ç«ç„°ï¼ŒåŠ›é‡æ›´åŠ ææ€–ã€‚', exp: 150, gold: 100, maxHp: 100, image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/demonking.png' };
                    setEnemyImage(enemy.name);
                    updateEnemyHpBar();
                    gameState = 'boss';
                    playerImage.classList.add('shake-up');
                    setTimeout(() => {
                        showCombatOptions();
                    }, 4000); // ç­‰å¾…å‹•ç•«å®Œæˆ
                    return;
                } else if (bossDefeatedCount === 2) {
                    winGame();
                    return;
                }
            }
            player.attack = baseStats.attack;
            player.defense = baseStats.defense;
            player.hp = Math.min(player.maxHp, baseStats.hp);
            player.tempStats = { attack: 0, defense: 0, hp: 0 };
            offerCombatReward();
            enemy = null;
            updateEnemyHpBar();
            updatePlayerHpBar();
            updatePlayerPanel();
            playerImage.classList.add('shake-up');
            gameState = 'floor';
        }

        function offerCombatReward() {
            if (Math.random() < 0.5) {
                display('åœ¨æ•µäººçš„æ®˜éª¸ä¸­ï¼Œä½ ç™¼ç¾äº†ä¸€äº›æˆ°åˆ©å“ï¼è«‹é¸æ“‡ä¸€é …ï¼š');
                clearChoices();
                const options = [];
                for (let i = 0; i < 3; i++) {
                    const reward = rewards[Math.floor(Math.random() * rewards.length)];
                    options.push(reward);
                    addChoice(reward.name, () => {
                        reward.effect();
                        display(`ä½ æ‹¾èµ·<span class="highlight">${reward.name}</span>ï¼Œä¸€è‚¡åŠ›é‡æ¹§å…¥ä½ çš„èº«é«”ã€‚`);
                        updatePlayerPanel();
                        if (actionsLeft > 0) {
                            afterAction();
                        } else if (currentFloor === 9) {
                            finalBoss();
                            gameState = 'boss';
                            showCombatOptions();
                        } else {
                            currentFloor++;
                            actionsLeft = 3;
                            exploreCount = 0;
                            showFloorOptions();
                        }
                    });
                }
            } else {
                display('é€™æ¬¡æˆ°é¬¥æ²’æœ‰é¡å¤–çš„æˆ°åˆ©å“ã€‚');
                if (actionsLeft > 0) {
                    afterAction();
                } else if (currentFloor === 9) {
                    finalBoss();
                    gameState = 'boss';
                    showCombatOptions();
                } else {
                    currentFloor++;
                    actionsLeft = 3;
                    exploreCount = 0;
                    showFloorOptions();
                }
            }
        }

        function offerReward() {
            display('æˆ°é¬¥çš„å¡µåŸƒè½å®šï¼Œä½ åœ¨æ•µäººæ®˜éª¸æ—ç™¼ç¾é–ƒè€€çš„å…‰èŠ’ï¼Œé‚£æ˜¯å‹åˆ©çš„çè³ï¼è«‹é¸æ“‡ä¸€é …ï¼š');
            clearChoices();
            const options = [];
            for (let i = 0; i < 3; i++) {
                const reward = rewards[Math.floor(Math.random() * rewards.length)];
                options.push(reward);
                addChoice(reward.name, () => {
                    reward.effect();
                    display(`ä½ æ‹¾èµ·<span class="highlight">${reward.name}</span>ï¼Œä¸€è‚¡åŠ›é‡æ¹§å…¥ä½ çš„èº«é«”ã€‚`);
                    afterAction();
                });
            }
            addChoice('ç¹¼çºŒ', afterAction);
        }

        function tradeWithMerchant() {
            display('ä¸€å€‹æŠ«è‘—æ–—ç¯·çš„<span class="highlight">ç¥ç§˜å•†äºº</span>å¾é™°å½±ä¸­èµ°å‡ºï¼Œä»–æ²™å•åœ°ç¬‘é“ï¼šâ€œä¾†çœ‹çœ‹æˆ‘çš„è²¨å§ï¼Œå‹‡å£«ï¼â€');
            clearChoices();
            addChoice('è³¼è²·æ²»ç™‚è—¥æ°´ (20 é‡‘å¹£)', () => {
                const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/cash.mp3'; // é ç•™éŸ³æ•ˆ URL
                playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
                if (player.gold >= 20) {
                    if (player.items.filter(item => item === 'æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)').length >= 1) {
                        display('ä½ å·²ç¶“æŒæœ‰ä¸€ç“¶æ²»ç™‚è—¥æ°´ï¼Œå•†äººæ–é ­èªªï¼šâ€œä½ ä¸éœ€è¦æ›´å¤šäº†ã€‚â€');
                    } else {
                        player.gold -= 20;
                        player.items.push('æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)');
                        player.inventory.push('æ²»ç™‚è—¥æ°´ (æ¢å¾© 20 HP)');
                        display('ä½ éå‡º20æšé‡‘å¹£ï¼Œæ›ä¾†ä¸€ç“¶æ•£ç™¼å¾®å…‰çš„<span class="highlight">æ²»ç™‚è—¥æ°´</span>ã€‚');
                        updatePlayerPanel();
                    }
                    tradeWithMerchant();
                } else {
                    display('ä½ çš„é‡‘å¹£ä¸è¶³ï¼Œå•†äººæ–äº†æ–é ­ã€‚');
                    tradeWithMerchant();
                }
            });
            addChoice('è³¼è²·ç‚¸å½ˆ (30 é‡‘å¹£)', () => {
                const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/cash.mp3'; // é ç•™éŸ³æ•ˆ URL
                playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
                if (player.gold >= 30) {
                    if (player.items.filter(item => item === 'ç‚¸å½ˆ (50 å‚·å®³)').length >= 1) {
                        display('ä½ å·²ç¶“æŒæœ‰ä¸€å€‹ç‚¸å½ˆï¼Œå•†äººæ–é ­èªªï¼šâ€œä½ ä¸éœ€è¦æ›´å¤šäº†ã€‚â€');
                    } else {
                        player.gold -= 30;
                        player.items.push('ç‚¸å½ˆ (50 å‚·å®³)');
                        player.inventory.push('ç‚¸å½ˆ (50 å‚·å®³)');
                        display('ä½ èŠ±è²»30æšé‡‘å¹£ï¼Œå•†äººéçµ¦ä½ ä¸€å€‹æ²‰ç”¸ç”¸çš„<span class="highlight">ç‚¸å½ˆ</span>ã€‚');
                        updatePlayerPanel();
                    }
                    tradeWithMerchant();
                } else {
                    display('ä½ çš„é‡‘å¹£ä¸è¶³ï¼Œå•†äººå†·ç¬‘ä¸€è²ã€‚');
                    tradeWithMerchant();
                }
            });
            addChoice('æ²»ç™’ç‹€æ…‹ (50 é‡‘å¹£)', () => {
                const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2025/02/cash.mp3'; // é ç•™éŸ³æ•ˆ URL
                playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
                if (player.gold >= 50) {
                    player.gold -= 50;
                    player.status = player.status.filter(s => s !== 'ä¸­æ¯’' && s !== 'æµè¡€' && s !== 'è©›å’’' && s !== 'ç‡ƒç‡’' && s !== 'å‡çµ');
                    for (let s in statusTurns) delete statusTurns[s];
                    display('å•†äººæ®æ‰‹æ–½å±•é­”æ³•ï¼Œä½ çš„ç•°å¸¸ç‹€æ…‹è¢«æ¸…é™¤ï¼');
                    updatePlayerPanel();
                    tradeWithMerchant();
                } else {
                    display('ä½ çš„é‡‘å¹£ä¸è¶³ï¼Œå•†äººè³äº†è³è‚©ã€‚');
                    tradeWithMerchant();
                }
            });
            addChoice('é›¢é–‹', () => {
                const soundUrl = ''; // é ç•™éŸ³æ•ˆ URL
                playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
                afterAction();
            });
        }

        function finalBoss() {
            display('ä½ çµ‚æ–¼è¸å…¥<span class="highlight">é­”ç‹åŸ</span>çš„æ·±æ·µï¼Œä¸€é™£é™°é¢¨å¹éï¼Œ<span class="highlight">é­”ç‹</span>å¾ç‹åº§èµ·èº«ï¼Œä»–çŒ™ç°çš„é¢å®¹è¢«ç«ç„°æ˜ ç…§ï¼Œèº«æŠ«é»‘éµæˆ°ç”²ï¼Œæ‰‹ä¸­å·¨åŠæ•£ç™¼æ­»äº¡æ°£æ¯ï¼');
            enemy = { name: 'é­”ç‹', hp: 150, attack: 30, defense: 20, special: 'poison', desc: 'é­”ç‹å±¹ç«‹æ–¼ç‹åº§ä¹‹å‰ï¼ŒçŒ©ç´…çš„æŠ«é¢¨éš¨é¢¨çµç·ä½œéŸ¿ï¼Œçœ¼ä¸­ç‡ƒç‡’è‘—æ¯€æ»…çš„ç«ç„°ã€‚', exp: 100, gold: 50, maxHp: 150, image: 'https://www.independent.com.tw/wp-content/uploads/2025/02/demonking.png' };
            setEnemyImage(enemy.name);
            const enemySpan = `<span class="enemy-name" style="color: ${enemyColors[enemy.name]}">${enemy.name}</span>`;
            display(`${enemySpan}å±¬æ€§ - HP: ${enemy.hp}, æ”»æ“Š: ${enemy.attack}, é˜²ç¦¦: ${enemy.defense}`);
            gameState = 'boss';
            updateEnemyHpBar();
            setTimeout(() => {
                showCombatOptions();
            }, 4000);
        }

        function winGame() {
            display('éš¨è‘—<span class="highlight">é­”ç‹</span>ç™¼å‡ºæœ€å¾Œä¸€è²å’†å“®ï¼Œä»–å€’åœ¨ç‹åº§å‰ï¼Œé­”ç‹åŸé–‹å§‹å´©å¡Œã€‚ä½ è¡å‡ºå¤§é–€ï¼Œé™½å…‰ç‘åœ¨èº«ä¸Šï¼Œæ­¤åœ°å·²æ¢å¾©å’Œå¹³ï¼Œæ­å–œä½ æˆåŠŸç ´é—œï¼');
            gameState = 'end';
            clearChoices();
            addChoice('å›åˆ°æ¨™é¡Œç•«é¢', () => {
                const soundUrl = 'https://www.independent.com.tw/wp-content/uploads/2024/10/change-select.mp3'; // é ç•™éŸ³æ•ˆ URL
                playSoundWithVolume(soundUrl); // ä½¿ç”¨çµ±ä¸€éŸ³é‡æ’­æ”¾
                location.reload();
            });
        }
    </script>
</body>
</html>